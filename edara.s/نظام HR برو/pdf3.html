<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Edara â€” Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø¨Ø±Ùˆ Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„ Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ© ÙˆØ§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©</title>
  <style>
  :root {
  --primary: #7e57c2;
  --primary-light: #b085f5;
  --primary-dark: #4d2c91;
  --primary-ultralight: #f3e5f5;
  --secondary: #f5f5f7;
  --text: #2d3748;
  --text-light: #718096;
  --text-lighter: #a0aec0;
  --white: #ffffff;
  --border: #e2e8f0;
  --shadow: 0 4px 20px rgba(126, 87, 194, 0.08);
  --shadow-hover: 0 8px 30px rgba(126, 87, 194, 0.12);
  --radius: 12px;
  --radius-sm: 8px;
  --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}
* { box-sizing: border-box; margin:0; padding:0 }
html,body{height:100%}
body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: linear-gradient(135deg, #f9f7ff 0%, #f0ebfa 100%);
  color: var(--text);
  line-height: 1.6;
  min-height: 100vh;
  direction: rtl;
}
.app { display:flex; min-height:100vh }
.sidebar { width:280px; background:var(--white); box-shadow:var(--shadow); display:flex; flex-direction:column; position:fixed; height:100vh; z-index:100; border-left:1px solid var(--border); }
.brand { padding:24px 20px; display:flex; gap:12px; align-items:center; border-bottom:1px solid var(--border); }
.logo { width:40px; height:40px; background:linear-gradient(135deg,var(--primary) 0%,var(--primary-light) 100%); border-radius:var(--radius-sm); display:flex; align-items:center; justify-content:center; color:var(--white); font-weight:bold; font-size:18px; box-shadow:0 4px 12px rgba(126,87,194,0.3); }
.brand-text .title { font-size:20px; font-weight:700; color:var(--primary-dark); }
.brand-text .subtitle { font-size:12px; color:var(--text-light); margin-top:2px }
.menu { flex:1; padding:20px 0; overflow-y:auto }
.menu-btn { width:100%; padding:14px 20px; text-align:right; background:none; border:none; color:var(--text-light); font-size:14px; cursor:pointer; transition:var(--transition); position:relative; border-left:3px solid transparent }
.menu-btn:hover { background:var(--primary-ultralight); color:var(--primary); border-left-color:var(--primary-light) }
.menu-btn.active { background:var(--primary-ultralight); color:var(--primary-dark); border-left-color:var(--primary); font-weight:600 }
.sidebar-bottom { padding:20px; border-top:1px solid var(--border); display:flex; gap:10px }
.main { flex:1; margin-right:280px; padding:0; background:transparent }
.topbar { background:var(--white); padding:20px 30px; display:flex; justify-content:space-between; align-items:center; box-shadow:0 2px 10px rgba(0,0,0,0.04); border-bottom:1px solid var(--border) }
.topbar h1 { font-size:24px; font-weight:700; color:var(--primary-dark); margin-bottom:4px }
.small.muted { font-size:13px; color:var(--text-light) }
.user { padding:8px 16px; background:var(--primary-ultralight); border-radius:var(--radius-sm); color:var(--primary); font-size:14px; font-weight:500 }
.content { padding:5px 24px 40px; min-height:auto }
.page { display:none }
.page.active { display:block; animation:fadeIn 0.4s ease }
@keyframes fadeIn { from{opacity:0; transform:translateY(10px)} to{opacity:1; transform:translateY(0)} }
.grid { display:grid; grid-template-columns:1fr 1fr; gap:24px; margin-bottom:24px }
.card { background:var(--white); border-radius:var(--radius); padding:24px; box-shadow:var(--shadow); border:1px solid var(--border); transition:var(--transition) }
.card:hover { box-shadow:var(--shadow-hover); transform:translateY(-2px) }
.card.wide { grid-column:1 / -1 }
.card h3 { font-size:18px; font-weight:600; color:var(--primary-dark); margin-bottom:12px }
.btn { background:linear-gradient(135deg,var(--primary) 0%,var(--primary-light) 100%); color:var(--white); border:none; padding:10px 20px; border-radius:var(--radius-sm); cursor:pointer; font-size:14px; font-weight:500; transition:var(--transition); box-shadow:0 2px 8px rgba(126,87,194,0.2) }
.btn:hover { transform:translateY(-1px); box-shadow:0 4px 15px rgba(126,87,194,0.3) }
.btn.ghost { background:transparent; color:var(--primary); border:1px solid var(--primary-light); box-shadow:none }
.btn.ghost:hover { background:var(--primary-ultralight); transform:none; box-shadow:none }
.btn.small { padding:6px 12px; font-size:12px }
.panel { background:var(--white); border-radius:var(--radius); box-shadow:var(--shadow); border:1px solid var(--border); overflow:hidden }
.panel-head { padding:20px 24px; border-bottom:1px solid var(--border); display:flex; justify-content:space-between; align-items:center; background:var(--white) }
.panel-head h2 { font-size:20px; font-weight:600; color:var(--primary-dark) }
.panel-body { padding:24px }
.toolbar { display:flex; gap:12px; margin-bottom:20px; flex-wrap:wrap; align-items:center }
.toolbar input, .toolbar select { padding:10px 14px; border:1px solid var(--border); border-radius:var(--radius-sm); background:var(--white); font-size:14px; transition:var(--transition); min-width:200px }
.toolbar input:focus, .toolbar select:focus { outline:none; border-color:var(--primary-light); box-shadow:0 0 0 3px rgba(126,87,194,0.1) }
.table-wrap { border:1px solid var(--border); border-radius:var(--radius-sm); overflow:hidden }
.table { width:100%; border-collapse:collapse; background:var(--white) }
.table th { background:var(--primary-ultralight); padding:14px 16px; text-align:right; font-weight:600; color:var(--primary-dark); font-size:14px; border-bottom:1px solid var(--border) }
.table td { padding:14px 16px; border-bottom:1px solid var(--border); font-size:14px }
.table tr:last-child td { border-bottom:none }
.table tr:hover { background:var(--primary-ultralight) }
.log { max-height:400px; overflow-y:auto; border:1px solid var(--border); border-radius:var(--radius-sm); padding:16px; background:var(--white) }
.log-item { padding:12px; border-bottom:1px solid var(--border); font-size:14px }
.log-item:last-child { border-bottom:none }
.log-item strong { color:var(--primary-dark) }
.form { display:flex; flex-direction:column; gap:16px }
.form label { font-weight:500; color:var(--text); font-size:14px; margin-bottom:4px }
.form input, .form textarea { padding:12px 16px; border:1px solid var(--border); border-radius:var(--radius-sm); font-size:14px; transition:var(--transition) }
.form input:focus, .form textarea:focus { outline:none; border-color:var(--primary-light); box-shadow:0 0 0 3px rgba(126,87,194,0.1) }
.modal { position:fixed; top:0; right:0; width:100%; height:100%; background:rgba(0,0,0,0.5); display:none; align-items:center; justify-content:center; z-index:1000; backdrop-filter:blur(4px) }
.modal-box { background:var(--white); border-radius:var(--radius); padding:30px; width:90%; max-width:900px; box-shadow:0 20px 60px rgba(0,0,0,0.2); animation:modalSlideIn 0.3s ease }
@keyframes modalSlideIn { from{opacity:0; transform:translateY(-20px) scale(0.95)} to{opacity:1; transform:translateY(0) scale(1)} }
.modal-actions { display:flex; gap:12px; margin-top:20px; justify-content:flex-end }
.setting-row { display:flex; justify-content:space-between; align-items:center; padding:12px 0; border-bottom:1px solid var(--border) }
.setting-row:last-child { border-bottom:none }
.shortcuts-list { list-style:none; padding:0 }
.shortcuts-list li { padding:10px 0; border-bottom:1px solid var(--border); display:flex; justify-content:space-between }
.shortcuts-list li:last-child { border-bottom:none }
.shortcuts-list strong { color:var(--primary-dark) }
.actions-vertical { display:flex; flex-direction:column; gap:12px }
.dropdown { position:relative; display:inline-block; margin-bottom:12px; width:100%; max-width:300px }
.dropdown input { width:100%; padding:8px 10px; border:1px solid #ccc; border-radius:8px; margin-bottom:6px; font-size:14px }
.dropdown-toggle { background:#7b2cbf; color:#fff; padding:10px 14px; border:none; border-radius:8px; cursor:pointer; font-weight:600; width:100% }
.dropdown-toggle:hover { background:#5a189a }
.dropdown-menu { position:absolute; top:100%; right:0; background:#fff; min-width:100%; max-height:200px; overflow-y:auto; box-shadow:0 6px 18px rgba(0,0,0,0.1); border-radius:8px; display:none; z-index:10 }
.dropdown-menu.active { display:block }
.dropdown-menu div { padding:10px; cursor:pointer; transition:background 0.2s }
.dropdown-menu div:hover { background:#f2f2f2 }
.log-item { background:#f8f8ff; border:1px solid #e6e6f5; border-radius:8px; padding:8px 10px; margin-top:8px; display:flex; justify-content:space-between; align-items:center }
.log-item strong { color:#5a189a }
.modal { display:none; position:fixed; inset:0; background:rgba(0,0,0,0.5); justify-content:center; align-items:center; overflow-y:auto; padding:20px; z-index:1000 }
.modal-box { background:#fff; color:#333; width:95%; max-width:1000px; max-height:90vh; display:flex; flex-direction:column; border-radius:12px; overflow:hidden; border-top:6px solid #8e44ad; box-shadow:0 8px 20px rgba(0,0,0,0.3) }
.modal-header { padding:16px 20px; background:#8e44ad; color:#fff; font-size:1.2em; font-weight:bold }
.modal-content { padding:16px 20px; flex-grow:1; overflow-y:auto; display:flex; flex-direction:column; gap:12px }
.modal-content input, .modal-content select, .modal-content textarea { width:100%; padding:10px 12px; border-radius:6px; border:1px solid #ccc; font-size:1em }
.modal-actions { padding:12px 20px; background:#f9f9f9; display:flex; justify-content:flex-end; gap:10px }
.modal-actions .btn { padding:8px 16px; border-radius:6px; border:none; cursor:pointer; font-weight:bold }
.modal-actions .btn.ghost { background:transparent; border:1px solid #8e44ad; color:#8e44ad }
.modal-actions .btn:not(.ghost) { background:#8e44ad; color:#fff }
@media (max-width:1024px){ .sidebar{width:240px} .main{margin-right:240px} .grid{grid-template-columns:1fr} }
@media (max-width:768px){ .sidebar{transform:translateX(100%); transition:transform 0.3s ease} .sidebar.open{transform:translateX(0)} .main{margin-right:0} .topbar{padding:15px 20px} .content{padding:20px} .toolbar{flex-direction:column; align-items:stretch} .toolbar input,.toolbar select{min-width:auto} }
.muted { color:var(--text-light) !important }
.small { font-size:13px !important }
.text-center { text-align:center !important }
::-webkit-scrollbar { width:6px }
::-webkit-scrollbar-track { background:var(--secondary) }
::-webkit-scrollbar-thumb { background:var(--primary-light); border-radius:3px }
::-webkit-scrollbar-thumb:hover { background:var(--primary) }

/* New styles for additional features */
.notification-badge { background:#ff4757; color:white; border-radius:50%; width:20px; height:20px; display:flex; align-items:center; justify-content:center; font-size:12px; position:absolute; top:-5px; left:-5px }
.calendar { display:grid; grid-template-columns:repeat(7,1fr); gap:8px; margin-top:16px }
.calendar-day { padding:12px; text-align:center; border-radius:var(--radius-sm); border:1px solid var(--border); cursor:pointer }
.calendar-day:hover { background:var(--primary-ultralight) }
.calendar-day.event { background:var(--primary-light); color:white }
.calendar-header { display:grid; grid-template-columns:repeat(7,1fr); gap:8px; margin-bottom:8px; text-align:center; font-weight:600 }
.profile-header { display:flex; gap:20px; align-items:center; margin-bottom:24px }
.profile-avatar { width:100px; height:100px; border-radius:50%; background:var(--primary); color:white; display:flex; align-items:center; justify-content:center; font-size:36px; font-weight:bold }
.profile-stats { display:grid; grid-template-columns:repeat(3,1fr); gap:16px; margin:20px 0 }
.profile-stat { text-align:center; padding:16px; background:var(--primary-ultralight); border-radius:var(--radius-sm) }
.profile-stat strong { display:block; font-size:24px; color:var(--primary-dark) }
.training-card { border-left:4px solid var(--primary); padding-left:16px }
.schedule-table { width:100%; border-collapse:collapse }
.schedule-table th, .schedule-table td { padding:12px; border:1px solid var(--border); text-align:center }
.schedule-table th { background:var(--primary-ultralight) }
.upload-area { border:2px dashed var(--border); border-radius:var(--radius); padding:40px; text-align:center; cursor:pointer; transition:var(--transition) }
.upload-area:hover { border-color:var(--primary-light); background:var(--primary-ultralight) }
.notification-item { padding:16px; border-bottom:1px solid var(--border); display:flex; gap:12px; align-items:flex-start }
.notification-item:last-child { border-bottom:none }
.notification-icon { width:40px; height:40px; border-radius:50%; background:var(--primary-ultralight); display:flex; align-items:center; justify-content:center; color:var(--primary); flex-shrink:0 }
.notification-content { flex:1 }
.notification-time { font-size:12px; color:var(--text-light) }
.badge { background:var(--primary); color:white; padding:4px 8px; border-radius:12px; font-size:12px; margin-left:8px }
.badge.success { background:#2ed573 }
.badge.warning { background:#ffa502 }
.badge.danger { background:#ff4757 }

/* New styles for profile image upload */
.profile-image-container { position:relative; display:inline-block; }
.profile-image { width:120px; height:120px; border-radius:50%; object-fit:cover; border:3px solid var(--primary-light); }
.profile-image-upload { position:absolute; bottom:0; left:0; background:var(--primary); color:white; border-radius:50%; width:32px; height:32px; display:flex; align-items:center; justify-content:center; cursor:pointer; box-shadow:0 2px 8px rgba(0,0,0,0.2); }
.profile-image-upload input { display:none; }
.employee-photo { width:40px; height:40px; border-radius:50%; object-fit:cover; margin-left:8px; vertical-align:middle; }
.employee-photo-small { width:30px; height:30px; border-radius:50%; object-fit:cover; margin-left:8px; vertical-align:middle; }
/* Teacher App specific styles - purple & white theme */
.teacher-app-view {
  background: linear-gradient(135deg, #b388ff 0%, #7c4dff 100%);
  color: white;
  min-height: 100vh;
  padding: 20px;
}

.teacher-app-view .card {
  background: rgba(255, 255, 255, 0.95);
  backdrop-filter: blur(10px);
  color: #3d2c8d;
}

.teacher-app-view .btn {
  background: linear-gradient(135deg, #b388ff 0%, #7c4dff 100%);
  color: white;
}

.teacher-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 24px;
}

.teacher-profile {
  display: flex;
  align-items: center;
  gap: 16px;
}

.teacher-stats {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 16px;
  margin: 24px 0;
}

.teacher-stat {
  background: rgba(255, 255, 255, 0.9);
  border-radius: var(--radius);
  padding: 20px;
  text-align: center;
  color: #3d2c8d;
}

.teacher-stat strong {
  display: block;
  font-size: 24px;
  color: #5e35b1;
}

.teacher-stat span {
  color: #8e8e8e;
  font-size: 14px;
}

.quick-actions {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 16px;
  margin: 24px 0;
}

.quick-action-btn {
  background: white;
  border: none;
  border-radius: var(--radius);
  padding: 20px;
  text-align: center;
  cursor: pointer;
  transition: var(--transition);
  box-shadow: var(--shadow);
  color: #5e35b1;
}

.quick-action-btn:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow-hover);
}

.quick-action-btn i {
  font-size: 24px;
  margin-bottom: 8px;
  display: block;
  color: #7c4dff;
}

.class-schedule {
  margin-top: 24px;
}

.class-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 16px;
  background: white;
  border-radius: var(--radius);
  margin-bottom: 12px;
  box-shadow: var(--shadow);
  color: #3d2c8d;
}

.class-time {
  font-weight: bold;
  color: #7c4dff;
}

.class-subject {
  color: #3d2c8d;
}

.class-room {
  color: #8e8e8e;
  font-size: 14px;
}

.attendance-status {
  display: flex;
  gap: 12px;
  margin-top: 16px;
}

.status-btn {
  flex: 1;
  padding: 12px;
  border: none;
  border-radius: var(--radius-sm);
  cursor: pointer;
  font-weight: 500;
  transition: var(--transition);
}

.status-present {
  background: #a463f2;
  color: white;
}

.status-absent {
  background: #d500f9;
  color: white;
}

.status-late {
  background: #ba68c8;
  color: white;
}

  </style>
</head>
<body>
  <div class="app" id="app">
    <aside class="sidebar" role="navigation" aria-label="Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ©">
      <div class="brand">
        <div class="logo">Ed</div>
        <div class="brand-text">
          <div class="title">edara</div>
          <div class="subtitle">Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø¨Ø±Ùˆ Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„ Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ© ÙˆØ§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©</div>
        </div>
      </div>
      <nav class="menu" id="menu">
        <button class="menu-btn active" data-page="dashboard">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</button>
        <button class="menu-btn" data-page="employees">Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</button>
        <button class="menu-btn" data-page="profiles">Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</button>
        <button class="menu-btn" data-page="attendance">Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„Ø§Ù†ØµØ±Ø§Ù</button>
        <button class="menu-btn" data-page="leaves">Ø§Ù„Ø¥Ø¬Ø§Ø²Ø§Øª</button>
        <button class="menu-btn" data-page="salaries">Ø§Ù„Ø±ÙˆØ§ØªØ¨</button>
        <button class="menu-btn" data-page="loans">Ø§Ù„Ø³Ù„Ù</button>
        <button class="menu-btn" data-page="training">Ø§Ù„ØªØ¯Ø±ÙŠØ¨ ÙˆØ§Ù„ØªØ·ÙˆÙŠØ±</button>
        <button class="menu-btn" data-page="schedules">Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©</button>
        <button class="menu-btn" data-page="calendar">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯</button>
        <button class="menu-btn" data-page="notifications">Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</button>
        <button class="menu-btn" data-page="reports">Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</button>
        <button class="menu-btn" data-page="teacherApp">ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ†</button>
        <button class="menu-btn" data-page="settings">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
        <button class="menu-btn" data-page="shortcuts">Ø§Ù„Ø§Ø®ØªØµØ§Ø±Ø§Øª</button>
      </nav>
      <div class="sidebar-bottom">
        <button class="btn ghost" id="exportBtn">ØªØµØ¯ÙŠØ±</button>
        <button class="btn ghost" id="importBtn">Ø§Ø³ØªÙŠØ±Ø§Ø¯</button>
      </div>
    </aside>

    <main class="main">
      <div class="topbar">
        <div>
          <h1>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h1>
          <div class="small muted">Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø¨Ø±Ùˆ Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„ Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ© ÙˆØ§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©</div>
        </div>
        <div class="user" id="currentUser">
          Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„
          <span class="notification-badge" id="notificationCount">3</span>
        </div>
      </div>

      <div class="content">
        <!-- Dashboard -->
        <section class="page active" id="dashboard">
          <div class="grid">
            <div class="card">
              <h3>Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©</h3>
              <div class="panel-body" id="overviewBody">
                <p class="muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø£ÙˆÙ„ÙŠØ©. Ø£Ø¶Ù Ù…ÙˆØ¸ÙÙŠÙ† Ù…Ù† Ù‚Ø³Ù… "Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†".</p>
              </div>
            </div>
            <div class="card">
              <h3>Ø¢Ø®Ø± Ø§Ù„Ø£Ù†Ø´Ø·Ø©</h3>
              <div class="log" id="activityLog"></div>
            </div>
            <div class="card wide">
              <h3>Ø§Ù„Ø­Ø¶ÙˆØ± Ø§Ù„ÙŠÙˆÙ…ÙŠ</h3>
              <div id="todayAttendance" class="panel-body">
                <p class="muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¯Ø®Ù„Ø§Øª Ø­Ø¶ÙˆØ± Ù„Ù„ÙŠÙˆÙ….</p>
              </div>
            </div>
          </div>
        </section>

        <!-- Employees -->
        <section class="page" id="employees">
          <div class="panel">
            <div class="panel-head">
              <h2>Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</h2>
              <div class="actions-vertical">
                <div class="toolbar">
                  <input type="text" id="empSearchInput" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…ÙˆØ¸Ù..." />
                  <button class="btn" id="addEmployeeBtn">Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¸Ù</button>
                </div>
              </div>
            </div>
            <div class="panel-body">
              <div class="table-wrap">
                <table class="table" id="employeesTable">
                  <thead>
                    <tr>
                      <th>Ø§Ù„ØµÙˆØ±Ø©</th>
                      <th>Ø§Ø³Ù…</th>
                      <th>ÙˆØ¸ÙŠÙØ©</th>
                      <th>Ø§Ù„Ù‚Ø³Ù…</th>
                      <th>Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ</th>
                      <th>Ù‡Ø§ØªÙ</th>
                      <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                    </tr>
                  </thead>
                  <tbody></tbody>
                </table>
              </div>
            </div>
          </div>
        </section>

        <!-- Employee Profiles -->
        <section class="page" id="profiles">
          <div class="panel">
            <div class="panel-head">
              <h2>Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ Ù„Ù„Ù…ÙˆØ¸Ù</h2>
              <div class="toolbar">
                <select id="profileEmpSelect"></select>
                <button class="btn" id="viewProfileBtn">Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</button>
              </div>
            </div>
            <div class="panel-body" id="profileBody">
              <p class="muted">Ø§Ø®ØªØ± Ù…ÙˆØ¸ÙÙ‹Ø§ Ø«Ù… Ø§Ø¶ØºØ· "Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ".</p>
            </div>
          </div>
        </section>

        <!-- Attendance -->
        <section class="page" id="attendance">
          <div class="grid">
            <div class="card">
              <h3>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ±</h3>
              <div class="panel-body">
                <div class="toolbar">
                  <select id="attEmpSelect"></select>
                  <button class="btn" id="manualIn">ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ ÙŠØ¯ÙˆÙŠ</button>
                  <button class="btn" id="manualOut">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬ ÙŠØ¯ÙˆÙŠ</button>
                </div>
                <hr />
                <h4>Ù…ÙŠØ²Ø© Ø§Ù„Ø¨ØµÙ…Ø© (Ù…Ø­Ø§ÙƒØ§Ø©)</h4>
                <p class="muted">Ø§Ù„Ø®Ø§ØµÙŠØ© ØªØ´ØªØºÙ„ Ø¨Ø§Ù„Ù…Ø­Ø§ÙƒØ§Ø© Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…ØªØµÙØ­Ø› ÙŠÙ…ÙƒÙ† Ø±Ø¨Ø· WebAuthn Ø£Ùˆ Ø¬Ù‡Ø§Ø² Ø®Ø§Ø±Ø¬ÙŠ Ù„Ø§Ø­Ù‚Ù‹Ø§.</p>
                <div class="toolbar">
                  <select id="bioEmpSelect"></select>
                  <button class="btn" id="bioIn">Ø¯Ø®ÙˆÙ„ Ø¨Ø¨ØµÙ…Ø©</button>
                  <button class="btn" id="bioOut">Ø®Ø±ÙˆØ¬ Ø¨Ø¨ØµÙ…Ø©</button>
                </div>
              </div>
            </div>

            <div class="card">
              <h3>Ø³Ø¬Ù„ Ø§Ù„Ø­Ø¶ÙˆØ±</h3>
              <div class="panel-body">
                <div class="toolbar">
                  <input type="date" id="attDate" />
                  <button class="btn ghost" id="filterAtt">ØªØµÙÙŠØ©</button>
                  <button class="btn ghost" id="clearAttFilter">Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„</button>
                </div>
                <div class="table-wrap">
                  <table class="table" id="attendanceTable">
                    <thead>
                      <tr><th>Ø§Ù„Ù…ÙˆØ¸Ù</th><th>ØªØ§Ø±ÙŠØ®</th><th>Ø¯Ø®ÙˆÙ„</th><th>Ø®Ø±ÙˆØ¬</th><th>Ù…ØµØ¯Ø±</th></tr>
                    </thead>
                    <tbody></tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Leaves -->
        <section class="page" id="leaves">
          <div class="panel">
            <div class="panel-head">
              <h2>Ø§Ù„Ø¥Ø¬Ø§Ø²Ø§Øª</h2>
              <div class="toolbar">
                <select id="leaveEmpSelect"></select>
                <button class="btn" id="requestLeaveBtn">ØªÙ‚Ø¯ÙŠÙ… Ø·Ù„Ø¨ Ø¥Ø¬Ø§Ø²Ø©</button>
              </div>
            </div>
            <div class="panel-body">
              <div class="table-wrap">
                <table class="table" id="leavesTable">
                  <thead>
                    <tr><th>Ø§Ù„Ù…ÙˆØ¸Ù</th><th>Ù…Ù†</th><th>Ø¥Ù„Ù‰</th><th>Ù†ÙˆØ¹</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th></tr>
                  </thead>
                  <tbody></tbody>
                </table>
              </div>
            </div>
          </div>
        </section>

        <!-- Salaries -->
        <section class="page" id="salaries">
          <div class="panel">
            <div class="panel-head">
              <h2>Ø§Ù„Ø±ÙˆØ§ØªØ¨</h2>
              <div class="toolbar">
                <select id="salaryEmpSelect"></select>
                <button class="btn" id="addSalaryBtn">Ø¥Ø¶Ø§ÙØ© Ø±Ø§ØªØ¨</button>
                <button class="btn ghost" id="exportSalaryBtn">ØªØµØ¯ÙŠØ± ÙƒØ´Ù Ø§Ù„Ø±ÙˆØ§ØªØ¨</button>
              </div>
            </div>
            <div class="panel-body">
              <div class="table-wrap">
                <table class="table" id="salaryTable">
                  <thead>
                    <tr><th>Ø§Ù„Ù…ÙˆØ¸Ù</th><th>Ø§Ù„Ø´Ù‡Ø±</th><th>Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ</th><th>Ø§Ù„Ù…ÙƒØ§ÙØ¢Øª</th><th>Ø§Ù„Ø®ØµÙˆÙ…Ø§Øª</th><th>Ø§Ù„ØµØ§ÙÙŠ</th><th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th></tr>
                  </thead>
                  <tbody></tbody>
                </table>
              </div>
            </div>
          </div>
        </section>

        <!-- Loans -->
        <section class="page" id="loans">
          <div class="panel">
            <div class="panel-head">
              <h2>Ø§Ù„Ø³Ù„Ù</h2>
              <div class="toolbar">
                <select id="loanEmpSelect"></select>
                <button class="btn" id="addLoanBtn">Ø¥Ø¶Ø§ÙØ© / ØªØ¹Ø¯ÙŠÙ„ Ø³Ù„ÙØ©</button>
              </div>
            </div>
            <div class="panel-body">
              <div class="table-wrap">
                <table class="table" id="loanTable">
                  <thead>
                    <tr><th>Ø§Ù„Ù…ÙˆØ¸Ù</th><th>Ø§Ù„Ù…Ø¨Ù„Øº</th><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th></tr>
                  </thead>
                  <tbody></tbody>
                </table>
              </div>
            </div>
          </div>
        </section>

        <!-- Training -->
        <section class="page" id="training">
          <div class="panel">
            <div class="panel-head">
              <h2>Ø§Ù„ØªØ¯Ø±ÙŠØ¨ ÙˆØ§Ù„ØªØ·ÙˆÙŠØ±</h2>
              <div class="toolbar">
                <button class="btn" id="addTrainingBtn">Ø¥Ø¶Ø§ÙØ© Ø¯ÙˆØ±Ø© ØªØ¯Ø±ÙŠØ¨ÙŠØ©</button>
              </div>
            </div>
            <div class="panel-body">
              <div class="table-wrap">
                <table class="table" id="trainingTable">
                  <thead>
                    <tr><th>Ø§Ø³Ù… Ø§Ù„Ø¯ÙˆØ±Ø©</th><th>Ø§Ù„Ù…Ø¯Ø±Ø¨</th><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ†</th><th>Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</th><th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th></tr>
                  </thead>
                  <tbody></tbody>
                </table>
              </div>
            </div>
          </div>
        </section>

        <!-- Schedules -->
        <section class="page" id="schedules">
          <div class="panel">
            <div class="panel-head">
              <h2>Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©</h2>
              <div class="toolbar">
                <select id="scheduleEmpSelect"></select>
                <button class="btn" id="addScheduleBtn">Ø¥Ø¶Ø§ÙØ© Ø¬Ø¯ÙˆÙ„</button>
                <button class="btn ghost" id="exportScheduleBtn">ØªØµØ¯ÙŠØ± Excel</button>
              </div>
            </div>
            <div class="panel-body">
              <div id="scheduleBody">
                <p class="muted">Ø§Ø®ØªØ± Ù…ÙˆØ¸ÙÙ‹Ø§ Ù„Ø¹Ø±Ø¶ Ø¬Ø¯ÙˆÙ„Ù‡ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ.</p>
              </div>
            </div>
          </div>
        </section>

        <!-- Calendar -->
        <section class="page" id="calendar">
          <div class="panel">
            <div class="panel-head">
              <h2>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯</h2>
              <div class="toolbar">
                <button class="btn" id="addEventBtn">Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¹Ø¯</button>
              </div>
            </div>
            <div class="panel-body">
              <div id="calendarBody">
                <div class="calendar-header">
                  <div>Ø§Ù„Ø£Ø­Ø¯</div><div>Ø§Ù„Ø§Ø«Ù†ÙŠÙ†</div><div>Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡</div><div>Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡</div><div>Ø§Ù„Ø®Ù…ÙŠØ³</div><div>Ø§Ù„Ø¬Ù…Ø¹Ø©</div><div>Ø§Ù„Ø³Ø¨Øª</div>
                </div>
                <div class="calendar" id="calendarGrid"></div>
              </div>
            </div>
          </div>
        </section>

        <!-- Notifications -->
        <section class="page" id="notifications">
          <div class="panel">
            <div class="panel-head">
              <h2>Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</h2>
              <div class="toolbar">
                <button class="btn ghost" id="markAllReadBtn">ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙ„ ÙƒÙ…Ù‚Ø±ÙˆØ¡</button>
              </div>
            </div>
            <div class="panel-body">
              <div id="notificationsList"></div>
            </div>
          </div>
        </section>

        <!-- Reports -->
        <section class="page" id="reports">
          <div class="panel">
            <div class="panel-head">
              <h2>Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</h2>
              <div class="toolbar">
                <select id="reportEmpSelect"></select>
                <button class="btn" id="viewReportBtn">Ø¹Ø±Ø¶ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…ÙˆØ¸Ù</button>
                <button class="btn ghost" id="trainingReportBtn">ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØªØ¯Ø±ÙŠØ¨</button>
              </div>
            </div>
            <div class="panel-body" id="reportBody">
              <p class="muted">Ø§Ø®ØªØ± Ù…ÙˆØ¸ÙÙ‹Ø§ Ø«Ù… Ø§Ø¶ØºØ· "Ø¹Ø±Ø¶ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…ÙˆØ¸Ù".</p>
            </div>
          </div>
        </section>

        <!-- Teacher App -->
        <section class="page" id="teacherApp">
          <div class="teacher-app-view">
            <div class="teacher-header">
              <h1 style="color: white;">ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ†</h1>
              <div class="teacher-profile">
                <div class="profile-image-container">
                  <img id="teacherProfileImage" class="profile-image" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' fill='%237e57c2'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' font-family='Arial' font-size='36' fill='white'%3EÙ…%3C/tspan%3E%3C/text%3E%3C/svg%3E" alt="ØµÙˆØ±Ø© Ø§Ù„Ù…Ø¹Ù„Ù…" />
                </div>
                <div>
                  <h2 style="color: white; margin: 0;" id="teacherName">Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯</h2>
                  <p style="color: rgba(255,255,255,0.8); margin: 0;">Ù…Ø¹Ù„Ù… Ø±ÙŠØ§Ø¶ÙŠØ§Øª</p>
                </div>
              </div>
            </div>

            <div class="teacher-stats">
              <div class="teacher-stat">
                <strong id="teacherBalance">5,800</strong>
                <span>Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù…Ø§Ù„ÙŠ</span>
              </div>
              <div class="teacher-stat">
                <strong id="teacherLeaveBalance">21</strong>
                <span>Ø±ØµÙŠØ¯ Ø§Ù„Ø¥Ø¬Ø§Ø²Ø§Øª</span>
              </div>
              <div class="teacher-stat">
                <strong id="teacherClasses">6</strong>
                <span>Ø¹Ø¯Ø¯ Ø§Ù„Ø­ØµØµ Ø§Ù„ÙŠÙˆÙ…</span>
              </div>
            </div>

            <div class="quick-actions">
              <button class="quick-action-btn" id="teacherProfileBtn">
                <i>ğŸ‘¤</i>
                <span>Ø§Ù„Ø¨Ø±ÙˆÙÙŠÙ„ Ø§Ù„Ø´Ø®ØµÙŠ</span>
              </button>
              <button class="quick-action-btn" id="teacherLeaveBtn">
                <i>ğŸ“…</i>
                <span>Ø·Ù„Ø¨ Ø§Ù„Ø¥Ø¬Ø§Ø²Ø§Øª</span>
              </button>
              <button class="quick-action-btn" id="teacherScheduleBtn">
                <i>ğŸ“š</i>
                <span>Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø­ØµØµ</span>
              </button>
              <button class="quick-action-btn" id="teacherAttendanceBtn">
                <i>â°</i>
                <span>Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø­Ø¶ÙˆØ±</span>
              </button>
              <button class="quick-action-btn" id="teacherNotificationsBtn">
                <i>ğŸ””</i>
                <span>Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„ÙÙˆØ±ÙŠØ©</span>
              </button>
              <button class="quick-action-btn" id="teacherDocumentsBtn">
                <i>ğŸ“„</i>
                <span>Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª</span>
              </button>
              <button class="quick-action-btn" id="teacherReportsBtn">
                <i>ğŸ“Š</i>
                <span>Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</span>
              </button>
              <button class="quick-action-btn" id="teacherSalaryBtn">
                <i>ğŸ’°</i>
                <span>Ø§Ù„Ø±ÙˆØ§ØªØ¨</span>
              </button>
            </div>

            <!-- Today's Schedule -->
            <div class="card">
              <h3>Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø­ØµØµ Ø§Ù„ÙŠÙˆÙ…</h3>
              <div class="class-schedule" id="todaySchedule">
                <div class="class-item">
                  <div>
                    <div class="class-time">08:00 - 09:00</div>
                    <div class="class-subject">Ø±ÙŠØ§Ø¶ÙŠØ§Øª - Ø§Ù„ØµÙ Ø§Ù„Ø¹Ø§Ø´Ø±</div>
                    <div class="class-room">Ø§Ù„Ù‚Ø§Ø¹Ø© Ù¢Ù Ù¡</div>
                  </div>
                  <button class="btn small">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ±</button>
                </div>
                <div class="class-item">
                  <div>
                    <div class="class-time">09:30 - 10:30</div>
                    <div class="class-subject">Ø±ÙŠØ§Ø¶ÙŠØ§Øª - Ø§Ù„ØµÙ Ø§Ù„Ø­Ø§Ø¯ÙŠ Ø¹Ø´Ø±</div>
                    <div class="class-room">Ø§Ù„Ù‚Ø§Ø¹Ø© Ù£Ù Ù¢</div>
                  </div>
                  <button class="btn small">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ±</button>
                </div>
                <div class="class-item">
                  <div>
                    <div class="class-time">11:00 - 12:00</div>
                    <div class="class-subject">Ø±ÙŠØ§Ø¶ÙŠØ§Øª - Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø¹Ø´Ø±</div>
                    <div class="class-room">Ø§Ù„Ù…Ø¹Ù…Ù„ Ù¡Ù Ù¡</div>
                  </div>
                  <button class="btn small">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ±</button>
                </div>
              </div>
            </div>

            <!-- Weekly Schedule -->
            <div class="card" style="margin-top: 24px;">
              <h3>Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠØ©</h3>
              <div class="table-wrap">
                <table class="table">
                  <thead>
                    <tr>
                      <th>Ø§Ù„ÙŠÙˆÙ…</th>
                      <th>Ø§Ù„Ø­ØµØ© Ø§Ù„Ø£ÙˆÙ„Ù‰</th>
                      <th>Ø§Ù„Ø­ØµØ© Ø§Ù„Ø«Ø§Ù†ÙŠØ©</th>
                      <th>Ø§Ù„Ø­ØµØ© Ø§Ù„Ø«Ø§Ù„Ø«Ø©</th>
                      <th>Ø§Ù„Ø­ØµØ© Ø§Ù„Ø±Ø§Ø¨Ø¹Ø©</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>Ø§Ù„Ø£Ø­Ø¯</td>
                      <td>Ø±ÙŠØ§Ø¶ÙŠØ§Øª - Ù¡Ù </td>
                      <td>---</td>
                      <td>Ø±ÙŠØ§Ø¶ÙŠØ§Øª - Ù¡Ù¡</td>
                      <td>---</td>
                    </tr>
                    <tr>
                      <td>Ø§Ù„Ø§Ø«Ù†ÙŠÙ†</td>
                      <td>---</td>
                      <td>Ø±ÙŠØ§Ø¶ÙŠØ§Øª - Ù¡Ù¢</td>
                      <td>Ø±ÙŠØ§Ø¶ÙŠØ§Øª - Ù¡Ù </td>
                      <td>---</td>
                    </tr>
                    <tr>
                      <td>Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡</td>
                      <td>Ø±ÙŠØ§Ø¶ÙŠØ§Øª - Ù¡Ù¡</td>
                      <td>---</td>
                      <td>---</td>
                      <td>Ø±ÙŠØ§Ø¶ÙŠØ§Øª - Ù¡Ù¢</td>
                    </tr>
                    <tr>
                      <td>Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡</td>
                      <td>---</td>
                      <td>Ø±ÙŠØ§Ø¶ÙŠØ§Øª - Ù¡Ù </td>
                      <td>Ø±ÙŠØ§Ø¶ÙŠØ§Øª - Ù¡Ù¡</td>
                      <td>---</td>
                    </tr>
                    <tr>
                      <td>Ø§Ù„Ø®Ù…ÙŠØ³</td>
                      <td>Ø±ÙŠØ§Ø¶ÙŠØ§Øª - Ù¡Ù¢</td>
                      <td>---</td>
                      <td>Ø±ÙŠØ§Ø¶ÙŠØ§Øª - Ù¡Ù </td>
                      <td>---</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>

            <!-- Attendance Tracking -->
            <div class="card" style="margin-top: 24px;">
              <h3>Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø­Ø¶ÙˆØ±</h3>
              <div class="panel-body">
                <p>Ø³Ø¬Ù„ Ø­Ø¶ÙˆØ±Ùƒ Ø§Ù„ÙŠÙˆÙ…ÙŠ:</p>
                <div class="attendance-status">
                  <button class="status-btn status-present" id="markPresent">Ø­Ø§Ø¶Ø±</button>
                  <button class="status-btn status-absent" id="markAbsent">ØºØ§Ø¦Ø¨</button>
                  <button class="status-btn status-late" id="markLate">Ù…ØªØ£Ø®Ø±</button>
                </div>
                <div style="margin-top: 16px;">
                  <h4>Ø³Ø¬Ù„ Ø§Ù„Ø­Ø¶ÙˆØ± Ø§Ù„Ø´Ù‡Ø±ÙŠ</h4>
                  <div class="table-wrap">
                    <table class="table">
                      <thead>
                        <tr>
                          <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                          <th>Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø¶ÙˆØ±</th>
                          <th>ÙˆÙ‚Øª Ø§Ù„ØªØ³Ø¬ÙŠÙ„</th>
                        </tr>
                      </thead>
                      <tbody id="teacherAttendanceHistory">
                        <!-- Will be populated by JavaScript -->
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>

            <!-- Notifications -->
            <div class="card" style="margin-top: 24px;">
              <h3>Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„ÙÙˆØ±ÙŠØ©</h3>
              <div id="teacherNotificationsList">
                <!-- Will be populated by JavaScript -->
              </div>
            </div>
          </div>
        </section>

        <!-- Settings -->
        <section class="page" id="settings">
          <div class="panel">
            <div class="panel-head">
              <h2>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h2>
            </div>
            <div class="panel-body">
              <div class="form">
                <div class="setting-row"><label>Ø§Ù„Ø­ÙØ¸ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ</label><input type="checkbox" id="autoSave" /></div>
                <div class="setting-row"><label>ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø­ÙØ¸ Ø§Ù„Ø«Ù‚Ø§ÙÙŠ</label><input type="checkbox" id="culturalSave" /></div>
                <div class="setting-row"><label>Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</label><button class="btn ghost" id="resetBtn">Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø·</button></div>
              </div>
            </div>
          </div>
        </section>

        <!-- Shortcuts -->
        <section class="page" id="shortcuts">
          <div class="card wide">
            <h3>Ø§Ù„Ø§Ø®ØªØµØ§Ø±Ø§Øª Ø¹Ø¨Ø± Ø§Ù„ÙƒÙŠØ¨ÙˆØ±Ø¯</h3>
            <div class="panel-body">
              <ul class="shortcuts-list" id="shortcutsList">
                <li><span>Shift + 1</span><strong>Ø§Ù†ØªÙ‚Ù„ Ø¥Ù„Ù‰ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</strong></li>
                <li><span>Shift + 2</span><strong>Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</strong></li>
                <li><span>Shift + 3</span><strong>Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</strong></li>
                <li><span>Shift + 4</span><strong>Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„Ø§Ù†ØµØ±Ø§Ù</strong></li>
                <li><span>Shift + 5</span><strong>Ø§Ù„Ø¥Ø¬Ø§Ø²Ø§Øª</strong></li>
                <li><span>Shift + 6</span><strong>Ø§Ù„Ø±ÙˆØ§ØªØ¨</strong></li>
                <li><span>Shift + 7</span><strong>Ø§Ù„Ø³Ù„Ù</strong></li>
                <li><span>Shift + 8</span><strong>Ø§Ù„ØªØ¯Ø±ÙŠØ¨ ÙˆØ§Ù„ØªØ·ÙˆÙŠØ±</strong></li>
                <li><span>Shift + 9</span><strong>Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©</strong></li>
                <li><span>Shift + 0</span><strong>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯</strong></li>
                <li><span>Shift + N</span><strong>Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</strong></li>
                <li><span>Shift + R</span><strong>Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</strong></li>
                <li><span>Shift + T</span><strong>ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ†</strong></li>
                <li><span>Shift + S</span><strong>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</strong></li>
                <li><span>Shift + H</span><strong>Ø§Ù„Ø§Ø®ØªØµØ§Ø±Ø§Øª</strong></li>
              </ul>
            </div>
          </div>
        </section>

      </div>
    </main>

    <!-- Modals -->
    <div class="modal" id="empModal">
      <div class="modal-box">
        <div class="modal-header">Ø¥Ø¶Ø§ÙØ© / ØªØ¹Ø¯ÙŠÙ„ Ù…ÙˆØ¸Ù</div>
        <div class="modal-content">
          <div class="profile-image-container">
            <img id="empPreviewImage" class="profile-image" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='120' height='120' viewBox='0 0 120 120'%3E%3Crect width='120' height='120' fill='%237e57c2'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' font-family='Arial' font-size='40' fill='white'%3E%3Ctspan x='50%25' dy='0'%3E%3C/tspan%3E%3C/text%3E%3C/svg%3E" alt="ØµÙˆØ±Ø© Ø§Ù„Ù…ÙˆØ¸Ù" />
            <div class="profile-image-upload" title="Ø±ÙØ¹ ØµÙˆØ±Ø©">
              <input type="file" id="empImageUpload" accept="image/*" />
              <span>+</span>
            </div>
          </div>
          <input placeholder="Ø§Ù„Ø§Ø³Ù…" id="empName" />
          <input placeholder="Ø§Ù„ÙˆØ¸ÙŠÙØ©" id="empJob" />
          <input placeholder="Ø§Ù„Ù‚Ø³Ù…" id="empDept" />
          <input placeholder="Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ" id="empSalary" type="number" />
          <input placeholder="Ø§Ù„Ù‡Ø§ØªÙ" id="empPhone" />
          <input placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" id="empEmail" type="email" />
          <input placeholder="Ù…Ø¹Ø±Ù Ø§Ù„Ø¨ØµÙ…Ø© (Ø±Ù‚Ù…) - Ø§Ø®ØªÙŠØ§Ø±ÙŠ" id="empBioId" />
        </div>
        <div class="modal-actions">
          <button class="btn ghost" id="closeEmpModal">Ø¥Ù„ØºØ§Ø¡</button>
          <button class="btn" id="saveEmpBtn">Ø­ÙØ¸</button>
        </div>
      </div>
    </div>

    <div class="modal" id="leaveModal">
      <div class="modal-box">
        <div class="modal-header">Ø·Ù„Ø¨ Ø¥Ø¬Ø§Ø²Ø©</div>
        <div class="modal-content">
          <select id="leaveEmp"></select>
          <input type="date" id="leaveFrom" />
          <input type="date" id="leaveTo" />
          <select id="leaveType"><option>Ø³Ù†ÙˆÙŠØ©</option><option>Ù…Ø±Ø¶ÙŠØ©</option><option>Ø¹Ø§Ø¦Ù„ÙŠØ©</option></select>
          <textarea id="leaveReason" placeholder="Ø³Ø¨Ø¨ Ø§Ù„Ø¥Ø¬Ø§Ø²Ø©"></textarea>
        </div>
        <div class="modal-actions">
          <button class="btn ghost" id="closeLeaveModal">Ø¥Ù„ØºØ§Ø¡</button>
          <button class="btn" id="saveLeaveBtn">Ø¥Ø±Ø³Ø§Ù„</button>
        </div>
      </div>
    </div>

    <div class="modal" id="salaryModal">
      <div class="modal-box">
        <div class="modal-header">Ø¥Ø¶Ø§ÙØ© Ø±Ø§ØªØ¨</div>
        <div class="modal-content">
          <select id="salaryEmp"></select>
          <input type="month" id="salaryMonth" />
          <input id="salaryBase" placeholder="Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ" type="number" />
          <input id="salaryBonus" placeholder="Ø§Ù„Ù…ÙƒØ§ÙØ¢Øª" type="number" value="0" />
          <input id="salaryDeduction" placeholder="Ø§Ù„Ø®ØµÙˆÙ…Ø§Øª" type="number" value="0" />
          <div id="salaryTotal" class="muted small"></div>
        </div>
        <div class="modal-actions">
          <button class="btn ghost" id="closeSalaryModal">Ø¥Ù„ØºØ§Ø¡</button>
          <button class="btn" id="saveSalaryBtn">Ø­ÙØ¸</button>
        </div>
      </div>
    </div>

    <div class="modal" id="loanModal">
      <div class="modal-box">
        <div class="modal-header">Ø¥Ø¶Ø§ÙØ© / ØªØ¹Ø¯ÙŠÙ„ Ø³Ù„ÙØ©</div>
        <div class="modal-content">
          <select id="loanEmp"></select>
          <input id="loanAmount" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº" type="number" />
          <input id="loanDate" type="date" />
          <select id="loanStatus">
            <option value="Ù…Ø¹Ù„Ù‚">Ù…Ø¹Ù„Ù‚</option>
            <option value="Ù…ÙˆØ§ÙÙ‚">Ù…ÙˆØ§ÙÙ‚</option>
            <option value="Ù…Ø±ÙÙˆØ¶">Ù…Ø±ÙÙˆØ¶</option>
            <option value="Ù…Ø³Ø¯Ø¯">Ù…Ø³Ø¯Ø¯</option>
          </select>
          <div id="salaryInfo" class="muted small"></div>
        </div>
        <div class="modal-actions">
          <button class="btn ghost" id="closeLoanModal">Ø¥Ù„ØºØ§Ø¡</button>
          <button class="btn" id="saveLoanBtn">Ø­ÙØ¸</button>
        </div>
      </div>
    </div>

    <div class="modal" id="trainingModal">
      <div class="modal-box">
        <div class="modal-header">Ø¥Ø¶Ø§ÙØ© Ø¯ÙˆØ±Ø© ØªØ¯Ø±ÙŠØ¨ÙŠØ©</div>
        <div class="modal-content">
          <input placeholder="Ø§Ø³Ù… Ø§Ù„Ø¯ÙˆØ±Ø©" id="trainingName" />
          <input placeholder="Ø§Ù„Ù…Ø¯Ø±Ø¨" id="trainingInstructor" />
          <input type="date" id="trainingDate" />
          <textarea id="trainingDescription" placeholder="ÙˆØµÙ Ø§Ù„Ø¯ÙˆØ±Ø©"></textarea>
          <select id="trainingParticipants" multiple>
            <!-- Will be populated with employees -->
          </select>
          <small>Ø§Ø¶ØºØ· Ctrl Ù„Ø§Ø®ØªÙŠØ§Ø± Ø£ÙƒØ«Ø± Ù…Ù† Ù…ÙˆØ¸Ù</small>
        </div>
        <div class="modal-actions">
          <button class="btn ghost" id="closeTrainingModal">Ø¥Ù„ØºØ§Ø¡</button>
          <button class="btn" id="saveTrainingBtn">Ø­ÙØ¸</button>
        </div>
      </div>
    </div>

    <div class="modal" id="eventModal">
      <div class="modal-box">
        <div class="modal-header">Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¹Ø¯</div>
        <div class="modal-content">
          <input placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…ÙˆØ¹Ø¯" id="eventTitle" />
          <input type="date" id="eventDate" />
          <input type="time" id="eventTime" />
          <select id="eventType">
            <option value="Ø§Ø¬ØªÙ…Ø§Ø¹">Ø§Ø¬ØªÙ…Ø§Ø¹</option>
            <option value="Ø§Ø®ØªØ¨Ø§Ø±">Ø§Ø®ØªØ¨Ø§Ø±</option>
            <option value="Ø¥Ø¬Ø§Ø²Ø©">Ø¥Ø¬Ø§Ø²Ø© Ø±Ø³Ù…ÙŠØ©</option>
            <option value="Ù…Ù†Ø§Ø³Ø¨Ø©">Ù…Ù†Ø§Ø³Ø¨Ø© Ø®Ø§ØµØ©</option>
          </select>
          <textarea id="eventDescription" placeholder="ÙˆØµÙ Ø§Ù„Ù…ÙˆØ¹Ø¯"></textarea>
        </div>
        <div class="modal-actions">
          <button class="btn ghost" id="closeEventModal">Ø¥Ù„ØºØ§Ø¡</button>
          <button class="btn" id="saveEventBtn">Ø­ÙØ¸</button>
        </div>
      </div>
    </div>

    <!-- Teacher App Modals -->
    <div class="modal" id="teacherLeaveModal">
      <div class="modal-box">
        <div class="modal-header">Ø·Ù„Ø¨ Ø¥Ø¬Ø§Ø²Ø© - ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ†</div>
        <div class="modal-content">
          <input type="date" id="teacherLeaveFrom" />
          <input type="date" id="teacherLeaveTo" />
          <select id="teacherLeaveType">
            <option>Ø³Ù†ÙˆÙŠØ©</option>
            <option>Ù…Ø±Ø¶ÙŠØ©</option>
            <option>Ø¹Ø§Ø¦Ù„ÙŠØ©</option>
            <option>Ø·Ø§Ø±Ø¦Ø©</option>
          </select>
          <textarea id="teacherLeaveReason" placeholder="Ø³Ø¨Ø¨ Ø§Ù„Ø¥Ø¬Ø§Ø²Ø©"></textarea>
        </div>
        <div class="modal-actions">
          <button class="btn ghost" id="closeTeacherLeaveModal">Ø¥Ù„ØºØ§Ø¡</button>
          <button class="btn" id="saveTeacherLeaveBtn">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨</button>
        </div>
      </div>
    </div>

    <input type="file" id="importFile" accept="application/json" style="display:none" />
  </div>

  <script>
  // Simple data storage via localStorage
  const DB_KEY = 'edara_db_v4';
  let db = { 
    employees:[], 
    attendance:[], 
    leaves:[], 
    salaries: [],
    loans:[], 
    activities:[],
    trainings:[],
    schedules:[],
    events:[],
    notifications:[],
    documents:[],
    teacherData: {
      currentTeacher: null,
      classSchedules: [],
      attendance: [],
      leaveBalance: 21,
      financialBalance: 5800
    }
  };

  function loadDB(){
    const raw = localStorage.getItem(DB_KEY);
    if(raw) db = JSON.parse(raw);
    
    // Add sample data if empty
    if(db.notifications.length === 0) {
      db.notifications = [
        { id: 'n1', title: 'Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø¥Ø¬Ø§Ø²Ø©', message: 'ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø·Ù„Ø¨ Ø¥Ø¬Ø§Ø²ØªÙƒ Ø§Ù„Ù…Ù‚Ø¯Ù… Ø¨ØªØ§Ø±ÙŠØ® 2023-10-01', time: new Date().toISOString(), read: false },
        { id: 'n2', title: 'Ø§Ø³ØªØ­Ù‚Ø§Ù‚ Ø±Ø§ØªØ¨', message: 'ØªÙ… ØµØ±Ù Ø±Ø§ØªØ¨ Ø´Ù‡Ø± Ø³Ø¨ØªÙ…Ø¨Ø±', time: new Date(Date.now() - 86400000).toISOString(), read: false },
        { id: 'n3', title: 'Ø¯ÙˆØ±Ø© ØªØ¯Ø±ÙŠØ¨ÙŠØ©', message: 'Ù‡Ù†Ø§Ùƒ Ø¯ÙˆØ±Ø© ØªØ¯Ø±ÙŠØ¨ÙŠØ© Ø¬Ø¯ÙŠØ¯Ø© Ù…ØªØ§Ø­Ø© Ù„Ù„Ù…Ø¹Ù„Ù…ÙŠÙ†', time: new Date(Date.now() - 172800000).toISOString(), read: false }
      ];
    }
    
    if(db.events.length === 0) {
      const today = new Date();
      db.events = [
        { id: 'e1', title: 'Ø§Ø¬ØªÙ…Ø§Ø¹ Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠÙ†', date: today.toISOString().split('T')[0], time: '10:00', type: 'Ø§Ø¬ØªÙ…Ø§Ø¹', description: 'Ø§Ø¬ØªÙ…Ø§Ø¹ Ø´Ù‡Ø±ÙŠ Ù„Ù„Ù…Ø¯Ø±Ø³ÙŠÙ†' },
        { id: 'e2', title: 'Ø§Ø®ØªØ¨Ø§Ø± Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ÙØµÙ„', date: new Date(today.getTime() + 7 * 86400000).toISOString().split('T')[0], time: '09:00', type: 'Ø§Ø®ØªØ¨Ø§Ø±', description: 'Ø§Ø®ØªØ¨Ø§Ø± Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ÙØµÙ„ Ø§Ù„Ø£ÙˆÙ„' }
      ];
    }

    // Initialize teacher data if empty
    if(!db.teacherData.classSchedules || db.teacherData.classSchedules.length === 0) {
      db.teacherData.classSchedules = [
        { day: 'Ø§Ù„Ø£Ø­Ø¯', time: '08:00 - 09:00', subject: 'Ø±ÙŠØ§Ø¶ÙŠØ§Øª - Ø§Ù„ØµÙ Ø§Ù„Ø¹Ø§Ø´Ø±', room: 'Ø§Ù„Ù‚Ø§Ø¹Ø© Ù¢Ù Ù¡' },
        { day: 'Ø§Ù„Ø£Ø­Ø¯', time: '09:30 - 10:30', subject: 'Ø±ÙŠØ§Ø¶ÙŠØ§Øª - Ø§Ù„ØµÙ Ø§Ù„Ø­Ø§Ø¯ÙŠ Ø¹Ø´Ø±', room: 'Ø§Ù„Ù‚Ø§Ø¹Ø© Ù£Ù Ù¢' },
        { day: 'Ø§Ù„Ø£Ø­Ø¯', time: '11:00 - 12:00', subject: 'Ø±ÙŠØ§Ø¶ÙŠØ§Øª - Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø¹Ø´Ø±', room: 'Ø§Ù„Ù…Ø¹Ù…Ù„ Ù¡Ù Ù¡' },
        { day: 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†', time: '10:00 - 11:00', subject: 'Ø±ÙŠØ§Ø¶ÙŠØ§Øª - Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø¹Ø´Ø±', room: 'Ø§Ù„Ù‚Ø§Ø¹Ø© Ù£Ù Ù¢' },
        { day: 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡', time: '08:30 - 09:30', subject: 'Ø±ÙŠØ§Ø¶ÙŠØ§Øª - Ø§Ù„ØµÙ Ø§Ù„Ø¹Ø§Ø´Ø±', room: 'Ø§Ù„Ù‚Ø§Ø¹Ø© Ù¢Ù Ù¡' }
      ];
    }

    if(!db.teacherData.attendance || db.teacherData.attendance.length === 0) {
      const today = new Date();
      for(let i = 0; i < 7; i++) {
        const date = new Date(today);
        date.setDate(date.getDate() - i);
        db.teacherData.attendance.push({
          date: date.toISOString().split('T')[0],
          status: i === 0 ? 'Ø­Ø§Ø¶Ø±' : (i === 1 ? 'Ù…ØªØ£Ø®Ø±' : 'Ø­Ø§Ø¶Ø±'),
          time: i === 0 ? '07:45' : (i === 1 ? '08:15' : '07:50')
        });
      }
    }
    
    forceSave();
  }
  
  function saveDB(){
    if(document.getElementById('autoSave') && document.getElementById('autoSave').checked) {
      localStorage.setItem(DB_KEY, JSON.stringify(db));
      logActivity('ØªÙ… Ø­ÙØ¸ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
    }
  }
  
  function forceSave(){ 
    localStorage.setItem(DB_KEY, JSON.stringify(db)); 
  }

  // Initialize
  loadDB();

  // UI helpers
  const pages = document.querySelectorAll('.page');
  document.querySelectorAll('.menu-btn').forEach(btn=>{
    btn.addEventListener('click', ()=>{ openPage(btn.dataset.page); })
  });
  
  function openPage(id){
    document.querySelectorAll('.menu-btn').forEach(b=>b.classList.toggle('active', b.dataset.page===id));
    pages.forEach(p=>p.classList.toggle('active', p.id===id));
    
    const pageTitles = {
      dashboard: 'Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…', 
      employees: 'Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†', 
      profiles: 'Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ',
      attendance: 'Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„Ø§Ù†ØµØ±Ø§Ù', 
      leaves: 'Ø§Ù„Ø¥Ø¬Ø§Ø²Ø§Øª', 
      salaries: 'Ø§Ù„Ø±ÙˆØ§ØªØ¨',
      loans: 'Ø§Ù„Ø³Ù„Ù',
      training: 'Ø§Ù„ØªØ¯Ø±ÙŠØ¨ ÙˆØ§Ù„ØªØ·ÙˆÙŠØ±',
      schedules: 'Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©',
      calendar: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯',
      notifications: 'Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª',
      reports: 'Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±', 
      teacherApp: 'ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ†',
      settings: 'Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª', 
      shortcuts: 'Ø§Ù„Ø§Ø®ØªØµØ§Ø±Ø§Øª'
    };
    
    document.querySelector('.topbar h1').textContent = pageTitles[id] || 'edara';
    
    // Special handling for teacher app
    if(id === 'teacherApp') {
      renderTeacherApp();
    } else {
      renderAll();
    }
  }

  // Activities log
  function logActivity(text){
    db.activities.unshift({time:new Date().toISOString(), text});
    if(db.activities.length>200) db.activities.pop();
    renderActivities();
    if(document.getElementById('autoSave') && document.getElementById('autoSave').checked) forceSave();
  }

  function renderActivities(){
    const el = document.getElementById('activityLog'); 
    if(!el) return;
    
    el.innerHTML='';
    if(!db.activities.length){ el.innerHTML='<p class="muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ù†Ø´Ø·Ø© Ø¨Ø¹Ø¯.</p>'; return; }
    db.activities.forEach(a=>{
      const div = document.createElement('div'); div.className='log-item';
      div.innerHTML = `<div><strong>${a.text}</strong><div class="small muted">${new Date(a.time).toLocaleString()}</div></div>`;
      el.appendChild(div);
    });
  }

  // Teacher App Functions
  function renderTeacherApp() {
    // Set teacher data
    const teacher = db.employees.find(e => e.job && e.job.includes('Ù…Ø¹Ù„Ù…')) || db.employees[0] || {
      name: 'Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯',
      job: 'Ù…Ø¹Ù„Ù… Ø±ÙŠØ§Ø¶ÙŠØ§Øª',
      photo: null
    };
    
    if(teacher) {
      document.getElementById('teacherName').textContent = teacher.name;
      document.getElementById('teacherBalance').textContent = db.teacherData.financialBalance.toLocaleString();
      document.getElementById('teacherLeaveBalance').textContent = db.teacherData.leaveBalance;
      document.getElementById('teacherClasses').textContent = db.teacherData.classSchedules.filter(c => c.day === getTodayArabic()).length;
      
      if(teacher.photo) {
        document.getElementById('teacherProfileImage').src = teacher.photo;
      }
    }
    
    // Render attendance history
    const attendanceHistory = document.getElementById('teacherAttendanceHistory');
    if(attendanceHistory) {
      attendanceHistory.innerHTML = '';
      db.teacherData.attendance.forEach(record => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${record.date}</td>
          <td><span class="badge ${record.status === 'Ø­Ø§Ø¶Ø±' ? 'success' : record.status === 'ØºØ§Ø¦Ø¨' ? 'danger' : 'warning'}">${record.status}</span></td>
          <td>${record.time}</td>
        `;
        attendanceHistory.appendChild(tr);
      });
    }
    
    // Render teacher notifications
    const teacherNotifications = document.getElementById('teacherNotificationsList');
    if(teacherNotifications) {
      teacherNotifications.innerHTML = '';
      const teacherNotificationsData = [
        { title: 'Ø§Ø¬ØªÙ…Ø§Ø¹ Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠÙ†', message: 'Ù‡Ù†Ø§Ùƒ Ø§Ø¬ØªÙ…Ø§Ø¹ Ù„Ù„Ù…Ø¯Ø±Ø³ÙŠÙ† ØºØ¯Ù‹Ø§ Ø§Ù„Ø³Ø§Ø¹Ø© 10:00 ØµØ¨Ø§Ø­Ù‹Ø§', time: new Date().toISOString() },
        { title: 'ØªØ°ÙƒÙŠØ± Ø¨Ø§Ù„ØªÙ‚ÙŠÙŠÙ…', message: 'ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø·Ù„Ø§Ø¨ Ù‚Ø¨Ù„ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹', time: new Date(Date.now() - 86400000).toISOString() },
        { title: 'ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù†Ù‡Ø¬', message: 'ØªÙ… ØªØ­Ø¯ÙŠØ« Ù…Ù†Ù‡Ø¬ Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª Ù„Ù„ÙØµÙ„ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ Ø§Ù„Ø«Ø§Ù†ÙŠ', time: new Date(Date.now() - 172800000).toISOString() }
      ];
      
      teacherNotificationsData.forEach(notification => {
        const notificationItem = document.createElement('div');
        notificationItem.className = 'notification-item';
        notificationItem.innerHTML = `
          <div class="notification-icon">
            <i>!</i>
          </div>
          <div class="notification-content">
            <strong>${notification.title}</strong>
            <p>${notification.message}</p>
            <div class="notification-time">${new Date(notification.time).toLocaleString()}</div>
          </div>
        `;
        teacherNotifications.appendChild(notificationItem);
      });
    }
  }

  function getTodayArabic() {
    const days = ['Ø§Ù„Ø£Ø­Ø¯', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡', 'Ø§Ù„Ø®Ù…ÙŠØ³', 'Ø§Ù„Ø¬Ù…Ø¹Ø©', 'Ø§Ù„Ø³Ø¨Øª'];
    return days[new Date().getDay()];
  }

  // Teacher App Event Listeners
  document.getElementById('teacherLeaveBtn').addEventListener('click', () => {
    document.getElementById('teacherLeaveModal').style.display = 'flex';
  });

  document.getElementById('closeTeacherLeaveModal').addEventListener('click', () => {
    document.getElementById('teacherLeaveModal').style.display = 'none';
  });

  document.getElementById('saveTeacherLeaveBtn').addEventListener('click', () => {
    const from = document.getElementById('teacherLeaveFrom').value;
    const to = document.getElementById('teacherLeaveTo').value;
    const type = document.getElementById('teacherLeaveType').value;
    const reason = document.getElementById('teacherLeaveReason').value;
    
    if(!from || !to) {
      alert('ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ¯ ØªØ§Ø±ÙŠØ® Ø¨Ø¯Ø§ÙŠØ© ÙˆÙ†Ù‡Ø§ÙŠØ© Ø§Ù„Ø¥Ø¬Ø§Ø²Ø©');
      return;
    }
    
    // Add to leaves
    const teacher = db.employees.find(e => e.job && e.job.includes('Ù…Ø¹Ù„Ù…')) || db.employees[0];
    if(teacher) {
      db.leaves.push({
        id: 'TL_' + Date.now(),
        empId: teacher.id,
        from,
        to,
        type,
        reason,
        status: 'Ù…Ø¹Ù„Ù‚'
      });
      
      // Update leave balance
      const days = Math.ceil((new Date(to) - new Date(from)) / (1000 * 60 * 60 * 24)) + 1;
      db.teacherData.leaveBalance -= days;
      
      logActivity('ØªÙ… ØªÙ‚Ø¯ÙŠÙ… Ø·Ù„Ø¨ Ø¥Ø¬Ø§Ø²Ø© Ù…Ù† ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ†');
      saveDB();
      document.getElementById('teacherLeaveModal').style.display = 'none';
      renderTeacherApp();
    }
  });

  // Attendance buttons for teacher app
  document.getElementById('markPresent').addEventListener('click', () => {
    recordTeacherAttendance('Ø­Ø§Ø¶Ø±');
  });

  document.getElementById('markAbsent').addEventListener('click', () => {
    recordTeacherAttendance('ØºØ§Ø¦Ø¨');
  });

  document.getElementById('markLate').addEventListener('click', () => {
    recordTeacherAttendance('Ù…ØªØ£Ø®Ø±');
  });

  function recordTeacherAttendance(status) {
    const today = new Date().toISOString().split('T')[0];
    const now = new Date();
    const time = now.toTimeString().split(':').slice(0, 2).join(':');
    
    // Check if already recorded today
    const existingRecord = db.teacherData.attendance.find(r => r.date === today);
    if(existingRecord) {
      existingRecord.status = status;
      existingRecord.time = time;
    } else {
      db.teacherData.attendance.unshift({
        date: today,
        status: status,
        time: time
      });
    }
    
    // Also record in main attendance
    const teacher = db.employees.find(e => e.job && e.job.includes('Ù…Ø¹Ù„Ù…')) || db.employees[0];
    if(teacher) {
      let mainRecord = db.attendance.find(a => a.empId === teacher.id && a.date === today);
      if(!mainRecord) {
        mainRecord = { empId: teacher.id, date: today, in: '', out: '', source: 'ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù…Ø¹Ù„Ù…' };
        db.attendance.push(mainRecord);
      }
      
      if(status === 'Ø­Ø§Ø¶Ø±' || status === 'Ù…ØªØ£Ø®Ø±') {
        mainRecord.in = time;
      }
    }
    
    logActivity(`ØªÙ… ØªØ³Ø¬ÙŠÙ„ ${status} Ù„Ù„Ù…Ø¹Ù„Ù…`);
    saveDB();
    renderTeacherApp();
  }

  // Quick action buttons
  document.getElementById('teacherProfileBtn').addEventListener('click', () => {
    const teacher = db.employees.find(e => e.job && e.job.includes('Ù…Ø¹Ù„Ù…')) || db.employees[0];
    if(teacher) {
      document.getElementById('profileEmpSelect').value = teacher.id;
      document.getElementById('viewProfileBtn').click();
      openPage('profiles');
    }
  });

  document.getElementById('teacherScheduleBtn').addEventListener('click', () => {
    const teacher = db.employees.find(e => e.job && e.job.includes('Ù…Ø¹Ù„Ù…')) || db.employees[0];
    if(teacher) {
      document.getElementById('scheduleEmpSelect').value = teacher.id;
      openPage('schedules');
    }
  });

  document.getElementById('teacherAttendanceBtn').addEventListener('click', () => {
    openPage('attendance');
  });

  document.getElementById('teacherNotificationsBtn').addEventListener('click', () => {
    openPage('notifications');
  });

  document.getElementById('teacherDocumentsBtn').addEventListener('click', () => {
    const teacher = db.employees.find(e => e.job && e.job.includes('Ù…Ø¹Ù„Ù…')) || db.employees[0];
    if(teacher) {
      document.getElementById('profileEmpSelect').value = teacher.id;
      document.getElementById('viewProfileBtn').click();
      openPage('profiles');
    }
  });

  document.getElementById('teacherReportsBtn').addEventListener('click', () => {
    const teacher = db.employees.find(e => e.job && e.job.includes('Ù…Ø¹Ù„Ù…')) || db.employees[0];
    if(teacher) {
      document.getElementById('reportEmpSelect').value = teacher.id;
      document.getElementById('viewReportBtn').click();
      openPage('reports');
    }
  });

  document.getElementById('teacherSalaryBtn').addEventListener('click', () => {
    openPage('salaries');
  });

  // [Rest of the existing JavaScript code remains the same - employees, attendance, leaves, salaries, etc.]
  // Employees CRUD
  function renderEmployees(){
    const tbody = document.querySelector('#employeesTable tbody'); 
    if(!tbody) return;
    
    tbody.innerHTML='';
    db.employees.forEach(emp=>{
      const tr = document.createElement('tr');
      const photoSrc = emp.photo || "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='40' height='40' viewBox='0 0 40 40'%3E%3Crect width='40' height='40' fill='%237e57c2'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' font-family='Arial' font-size='16' fill='white'%3E%3Ctspan x='50%25' dy='0'%3E${emp.name ? emp.name.charAt(0) : '?'}%3C/tspan%3E%3C/text%3E%3C/svg%3E";
      
      tr.innerHTML = `
        <td><img src="${photoSrc}" class="employee-photo" alt="${emp.name}" /></td>
        <td>${emp.name||''}</td>
        <td>${emp.job||''}</td>
        <td>${emp.dept||''}</td>
        <td>${emp.salary||0}</td>
        <td>${emp.phone||''}</td>
        <td>
          <button class="btn small" data-id="${emp.id}" data-act="edit">ØªØ¹Ø¯ÙŠÙ„</button>
          <button class="btn ghost small" data-id="${emp.id}" data-act="del">Ø­Ø°Ù</button>
        </td>`;
      tbody.appendChild(tr);
    });
    // attach events
    tbody.querySelectorAll('button').forEach(b=>b.addEventListener('click', e=>{
      const id = e.target.dataset.id; const act = e.target.dataset.act;
      if(act==='edit') openEmpModal(id);
      if(act==='del') { if(confirm('Ø­Ø°Ù Ø§Ù„Ù…ÙˆØ¸Ù Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ')){ db.employees = db.employees.filter(x=>x.id!==id); logActivity('Ø­ÙØ°Ù Ù…ÙˆØ¸Ù'); saveDB(); renderAll(); }}
      if(act==='archive') { const emp = db.employees.find(x=>x.id===id); if(emp){ emp.archived = true; logActivity('ØªÙ… Ø£Ø±Ø´ÙØ© Ù…ÙˆØ¸Ù'); saveDB(); renderAll(); }}
    }));
  }

  function openEmpModal(id){
    const modal = document.getElementById('empModal'); modal.style.display='flex';
    document.getElementById('empName').value=''; document.getElementById('empJob').value=''; document.getElementById('empDept').value=''; document.getElementById('empSalary').value=''; document.getElementById('empPhone').value=''; document.getElementById('empEmail').value=''; document.getElementById('empBioId').value='';
    
    const defaultPhoto = "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='120' height='120' viewBox='0 0 120 120'%3E%3Crect width='120' height='120' fill='%237e57c2'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' font-family='Arial' font-size='40' fill='white'%3E%3Ctspan x='50%25' dy='0'%3E%3C/tspan%3E%3C/text%3E%3C/svg%3E";
    document.getElementById('empPreviewImage').src = defaultPhoto;
    
    modal.dataset.edit = id||'';
    if(id){ 
      const emp = db.employees.find(x=>x.id===id); 
      if(emp){ 
        document.getElementById('empName').value=emp.name||''; 
        document.getElementById('empJob').value=emp.job||''; 
        document.getElementById('empDept').value=emp.dept||''; 
        document.getElementById('empSalary').value=emp.salary||''; 
        document.getElementById('empPhone').value=emp.phone||''; 
        document.getElementById('empEmail').value=emp.email||''; 
        document.getElementById('empBioId').value=emp.bioId||''; 
        if(emp.photo) {
          document.getElementById('empPreviewImage').src = emp.photo;
        }
      }
    }
  }
  
  if(document.getElementById('addEmployeeBtn')) {
    document.getElementById('addEmployeeBtn').addEventListener('click', ()=>openEmpModal());
  }
  
  if(document.getElementById('closeEmpModal')) {
    document.getElementById('closeEmpModal').addEventListener('click', ()=>{ document.getElementById('empModal').style.display='none'; });
  }
  
  // Handle image upload
  if(document.getElementById('empImageUpload')) {
    document.getElementById('empImageUpload').addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(event) {
          document.getElementById('empPreviewImage').src = event.target.result;
        };
        reader.readAsDataURL(file);
      }
    });
  }
  
  if(document.getElementById('saveEmpBtn')) {
    document.getElementById('saveEmpBtn').addEventListener('click', ()=>{
      const modal = document.getElementById('empModal'); const id = modal.dataset.edit;
      const name = document.getElementById('empName').value.trim();
      if(!name){ alert('Ø§Ù„Ø§Ø³Ù… Ù…Ø·Ù„ÙˆØ¨'); return; }
      const salary = Number(document.getElementById('empSalary').value) || 0;
      const photo = document.getElementById('empPreviewImage').src;
      
      if(id){ 
        const emp = db.employees.find(x=>x.id===id); 
        Object.assign(emp,{
          name, 
          job:document.getElementById('empJob').value, 
          dept:document.getElementById('empDept').value, 
          salary, 
          phone:document.getElementById('empPhone').value, 
          email:document.getElementById('empEmail').value,
          bioId:document.getElementById('empBioId').value,
          photo
        }); 
        logActivity('ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ù…ÙˆØ¸Ù'); 
      }
      else{ 
        const newEmp = { 
          id: 'e_'+Date.now(), 
          name, 
          job:document.getElementById('empJob').value, 
          dept:document.getElementById('empDept').value, 
          salary, 
          phone:document.getElementById('empPhone').value, 
          email:document.getElementById('empEmail').value,
          bioId:document.getElementById('empBioId').value,
          photo
        }; 
        db.employees.push(newEmp); 
        logActivity('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¸Ù Ø¬Ø¯ÙŠØ¯'); 
      }
      document.getElementById('empModal').style.display='none'; saveDB(); renderAll();
    });
  }

  // Attendance
  function renderAttendance(){
    const tbody = document.querySelector('#attendanceTable tbody'); 
    if(!tbody) return;
    
    tbody.innerHTML='';
    db.attendance.forEach(a=>{
      const tr = document.createElement('tr');
      const emp = db.employees.find(e=>e.id===a.empId) || {name:'--'};
      tr.innerHTML = `<td>${emp.name}</td><td>${a.date}</td><td>${a.in||''}</td><td>${a.out||''}</td><td>${a.source||''}</td>`;
      tbody.appendChild(tr);
    });
  }

  function renderAttendanceSelectors(){
    const selectors = [
      'attEmpSelect','bioEmpSelect','leaveEmp','leaveEmpSelect',
      'loanEmpSelect','loanEmp','reportEmpSelect','profileEmpSelect',
      'scheduleEmpSelect', 'salaryEmpSelect', 'salaryEmp'
    ];
    
    selectors.forEach(id=>{
      const sel = document.getElementById(id); 
      if(!sel) return;
      
      sel.innerHTML='';
      db.employees.filter(e=>!e.archived).forEach(e=>{ 
        const opt=document.createElement('option'); 
        opt.value=e.id; 
        opt.textContent=e.name; 
        sel.appendChild(opt); 
      });
    });
    
    // Populate training participants
    const trainingParticipants = document.getElementById('trainingParticipants');
    if(trainingParticipants) {
      trainingParticipants.innerHTML = '';
      db.employees.filter(e=>!e.archived).forEach(e=>{ 
        const opt=document.createElement('option'); 
        opt.value=e.id; 
        opt.textContent=e.name; 
        trainingParticipants.appendChild(opt); 
      });
    }
  }

  if(document.getElementById('manualIn')) {
    document.getElementById('manualIn').addEventListener('click', ()=>{
      const empId = document.getElementById('attEmpSelect').value; if(!empId) { alert('Ø§Ø®ØªØ± Ù…ÙˆØ¸Ù'); return; }
      const today = new Date(); const date = today.toISOString().slice(0,10);
      let rec = db.attendance.find(x=>x.empId===empId && x.date===date);
      if(!rec) { rec = {empId, date, in: today.toTimeString().slice(0,8), out:'', source:'ÙŠØ¯ÙˆÙŠ'}; db.attendance.push(rec); }
      else { rec.in = today.toTimeString().slice(0,8); rec.source = (rec.source||'') + ' & ÙŠØ¯ÙˆÙŠ'; }
      logActivity('ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ ÙŠØ¯ÙˆÙŠ Ù„Ù…ÙˆØ¸Ù'); saveDB(); renderAll();
    });
  }
  
  if(document.getElementById('manualOut')) {
    document.getElementById('manualOut').addEventListener('click', ()=>{
      const empId = document.getElementById('attEmpSelect').value; if(!empId) { alert('Ø§Ø®ØªØ± Ù…ÙˆØ¸Ù'); return; }
      const today = new Date(); const date = today.toISOString().slice(0,10);
      let rec = db.attendance.find(x=>x.empId===empId && x.date===date);
      if(!rec) { rec = {empId, date, in:'', out: today.toTimeString().slice(0,8), source:'ÙŠØ¯ÙˆÙŠ'}; db.attendance.push(rec); }
      else { rec.out = today.toTimeString().slice(0,8); rec.source = (rec.source||'') + ' & ÙŠØ¯ÙˆÙŠ'; }
      logActivity('ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬ ÙŠØ¯ÙˆÙŠ Ù„Ù…ÙˆØ¸Ù'); saveDB(); renderAll();
    });
  }

  // Biometric simulation (mapping bioId)
  function performBio(empId, type){
    const emp = db.employees.find(e=>e.id===empId); if(!emp){ alert('Ù…ÙˆØ¸Ù ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯'); return; }
    const now = new Date(); const date = now.toISOString().slice(0,10);
    let rec = db.attendance.find(x=>x.empId===empId && x.date===date);
    if(!rec){ rec = {empId, date, in:'', out:'', source:'Ø¨ØµÙ…Ø©'}; db.attendance.push(rec); }
    if(type==='in') rec.in = now.toTimeString().slice(0,8);
    else rec.out = now.toTimeString().slice(0,8);
    rec.source = 'Ø¨ØµÙ…Ø©';
    logActivity(`Ø¨ØµÙ…Ø© ${type==='in'?'Ø¯Ø®ÙˆÙ„':'Ø®Ø±ÙˆØ¬'} â€” ${emp.name}`);
    saveDB(); renderAll();
  }
  
  if(document.getElementById('bioIn')) {
    document.getElementById('bioIn').addEventListener('click', ()=>{ performBio(document.getElementById('bioEmpSelect').value,'in'); });
  }
  
  if(document.getElementById('bioOut')) {
    document.getElementById('bioOut').addEventListener('click', ()=>{ performBio(document.getElementById('bioEmpSelect').value,'out'); });
  }

  // Leaves
  if(document.getElementById('requestLeaveBtn')) {
    document.getElementById('requestLeaveBtn').addEventListener('click', ()=>{ document.getElementById('leaveModal').style.display='flex'; });
  }
  
  if(document.getElementById('closeLeaveModal')) {
    document.getElementById('closeLeaveModal').addEventListener('click', ()=>{ document.getElementById('leaveModal').style.display='none'; });
  }
  
  if(document.getElementById('saveLeaveBtn')) {
    document.getElementById('saveLeaveBtn').addEventListener('click', ()=>{
      const empId = document.getElementById('leaveEmp').value; const from = document.getElementById('leaveFrom').value; const to = document.getElementById('leaveTo').value; const type = document.getElementById('leaveType').value; const reason = document.getElementById('leaveReason').value;
      if(!empId||!from||!to){ alert('Ø§Ù…Ù„Ø£ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©'); return; }
      db.leaves.push({id:'L_'+Date.now(), empId, from, to, type, reason, status:'Ù…Ø¹Ù„Ù‚'});
      logActivity('ØªÙ… ØªÙ‚Ø¯ÙŠÙ… Ø·Ù„Ø¨ Ø¥Ø¬Ø§Ø²Ø©'); saveDB(); document.getElementById('leaveModal').style.display='none'; renderAll();
    });
  }

  function renderLeaves(){
    const tbody = document.querySelector('#leavesTable tbody'); 
    if(!tbody) return;
    
    tbody.innerHTML='';
    db.leaves.forEach(l=>{
      const emp = db.employees.find(e=>e.id===l.empId)||{name:'--'};
      const tr = document.createElement('tr'); tr.innerHTML = `<td>${emp.name}</td><td>${l.from}</td><td>${l.to}</td><td>${l.type}</td><td>${l.status}</td><td>
        <button class="btn small" data-id="${l.id}" data-act="approve">Ù…ÙˆØ§ÙÙ‚Ø©</button>
        <button class="btn ghost small" data-id="${l.id}" data-act="reject">Ø±ÙØ¶</button>
        <button class="btn ghost small" data-id="${l.id}" data-act="del">Ø­Ø°Ù</button>
      </td>`;
      tbody.appendChild(tr);
    });
    tbody.querySelectorAll('button').forEach(b=>b.addEventListener('click', e=>{
      const id = e.target.dataset.id; const act = e.target.dataset.act; const item = db.leaves.find(x=>x.id===id);
      if(!item) return;
      if(act==='approve'){ item.status='Ù…ÙˆØ§ÙÙ‚'; logActivity('ØªÙ… Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø¥Ø¬Ø§Ø²Ø©'); saveDB(); }
      if(act==='reject'){ item.status='Ù…Ø±ÙÙˆØ¶'; logActivity('ØªÙ… Ø±ÙØ¶ Ø¥Ø¬Ø§Ø²Ø©'); saveDB(); }
      if(act==='del'){ db.leaves = db.leaves.filter(x=>x.id!==id); logActivity('ØªÙ… Ø­Ø°Ù Ø¥Ø¬Ø§Ø²Ø©'); saveDB(); }
      renderAll();
    }));
  }

  // Salaries
  if(document.getElementById('addSalaryBtn')) {
    document.getElementById('addSalaryBtn').addEventListener('click', ()=>{ document.getElementById('salaryModal').style.display='flex'; });
  }
  
  if(document.getElementById('closeSalaryModal')) {
    document.getElementById('closeSalaryModal').addEventListener('click', ()=>{ document.getElementById('salaryModal').style.display='none'; });
  }
  
  // Update salary total when values change
  if(document.getElementById('salaryBase') && document.getElementById('salaryBonus') && document.getElementById('salaryDeduction')) {
    const updateSalaryTotal = () => {
      const base = Number(document.getElementById('salaryBase').value) || 0;
      const bonus = Number(document.getElementById('salaryBonus').value) || 0;
      const deduction = Number(document.getElementById('salaryDeduction').value) || 0;
      const total = base + bonus - deduction;
      document.getElementById('salaryTotal').textContent = `Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„ØµØ§ÙÙŠ: ${total}`;
    };
    
    document.getElementById('salaryBase').addEventListener('input', updateSalaryTotal);
    document.getElementById('salaryBonus').addEventListener('input', updateSalaryTotal);
    document.getElementById('salaryDeduction').addEventListener('input', updateSalaryTotal);
  }
  
  if(document.getElementById('saveSalaryBtn')) {
    document.getElementById('saveSalaryBtn').addEventListener('click', ()=>{
      const empId = document.getElementById('salaryEmp').value; 
      const month = document.getElementById('salaryMonth').value; 
      const base = Number(document.getElementById('salaryBase').value||0); 
      const bonus = Number(document.getElementById('salaryBonus').value||0); 
      const deduction = Number(document.getElementById('salaryDeduction').value||0);
      
      if(!empId || !month || !base){ alert('Ø§Ù…Ù„Ø£ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©'); return; }
      
      const rec = db.salaries.find(x=>x.empId===empId && x.month===month);
      if(rec) Object.assign(rec,{base, bonus, deduction}); 
      else db.salaries.push({id:'S_'+Date.now(), empId, month, base, bonus, deduction});
      
      logActivity('ØªÙ… Ø­ÙØ¸ Ø±Ø§ØªØ¨ Ù„Ù…ÙˆØ¸Ù'); 
      saveDB(); 
      document.getElementById('salaryModal').style.display='none'; 
      renderAll();
    });
  }

  function renderSalaries(){
    const tbody = document.querySelector('#salaryTable tbody'); 
    if(!tbody) return;
    
    tbody.innerHTML='';
    db.salaries.forEach(s=>{
      const emp = db.employees.find(e=>e.id===s.empId) || {name:'--'};
      const total = (s.base || 0) + (s.bonus || 0) - (s.deduction || 0);
      const tr = document.createElement('tr'); tr.innerHTML=`<td>${emp.name}</td><td>${s.month}</td><td>${s.base}</td><td>${s.bonus}</td><td>${s.deduction}</td><td>${total}</td><td>
        <button class="btn small" data-id="${s.id}" data-act="editSalary">ØªØ¹Ø¯ÙŠÙ„</button>
        <button class="btn ghost small" data-id="${s.id}" data-act="delSalary">Ø­Ø°Ù</button>
      </td>`;
      tbody.appendChild(tr);
    });
    tbody.querySelectorAll('button').forEach(b=>b.addEventListener('click', e=>{
      const id = e.target.dataset.id; const act = e.target.dataset.act; const rec = db.salaries.find(x=>x.id===id);
      if(!rec) return; 
      if(act==='editSalary'){ 
        document.getElementById('salaryModal').style.display='flex'; 
        document.getElementById('salaryEmp').value=rec.empId; 
        document.getElementById('salaryMonth').value=rec.month; 
        document.getElementById('salaryBase').value=rec.base; 
        document.getElementById('salaryBonus').value=rec.bonus; 
        document.getElementById('salaryDeduction').value=rec.deduction; 
        
        // Trigger salary total update
        if(document.getElementById('salaryBase')) {
          document.getElementById('salaryBase').dispatchEvent(new Event('input'));
        }
      }
      if(act==='delSalary'){ db.salaries = db.salaries.filter(x=>x.id!==id); logActivity('ØªÙ… Ø­Ø°Ù Ø±Ø§ØªØ¨'); saveDB(); renderAll(); }
    }));
  }

  // Loans
  if(document.getElementById('addLoanBtn')) {
    document.getElementById('addLoanBtn').addEventListener('click', ()=>{ document.getElementById('loanModal').style.display='flex'; });
  }
  
  if(document.getElementById('closeLoanModal')) {
    document.getElementById('closeLoanModal').addEventListener('click', ()=>{ document.getElementById('loanModal').style.display='none'; });
  }
  
  // Update salary info when employee is selected in loan modal
  if(document.getElementById('loanEmp')) {
    document.getElementById('loanEmp').addEventListener('change', function() {
      const empId = this.value;
      const emp = db.employees.find(e => e.id === empId);
      const salaryInfo = document.getElementById('salaryInfo');
      
      if (emp && emp.salary) {
        const totalLoans = db.loans
          .filter(l => l.empId === empId && l.status === 'Ù…ÙˆØ§ÙÙ‚')
          .reduce((sum, loan) => sum + (loan.amount || 0), 0);
        
        const remainingSalary = emp.salary - totalLoans;
        
        salaryInfo.innerHTML = `
          <div>Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ: ${emp.salary}</div>
          <div>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ù„Ù: ${totalLoans}</div>
          <div>Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${remainingSalary}</div>
        `;
      } else {
        salaryInfo.innerHTML = emp ? `Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ: ${emp.salary || 0}` : '';
      }
    });
  }

  if(document.getElementById('saveLoanBtn')) {
    document.getElementById('saveLoanBtn').addEventListener('click', ()=>{
      const empId = document.getElementById('loanEmp').value; 
      const amount = Number(document.getElementById('loanAmount').value||0); 
      const date = document.getElementById('loanDate').value; 
      const status = document.getElementById('loanStatus').value;
      
      if(!empId || !amount || !date){ alert('Ø§Ù…Ù„Ø£ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©'); return; }
      
      // Check if loan amount exceeds remaining salary
      if (status === 'Ù…ÙˆØ§ÙÙ‚') {
        const emp = db.employees.find(e => e.id === empId);
        if (emp && emp.salary) {
          const totalLoans = db.loans
            .filter(l => l.empId === empId && l.status === 'Ù…ÙˆØ§ÙÙ‚')
            .reduce((sum, loan) => sum + (loan.amount || 0), 0);
          
          const remainingSalary = emp.salary - totalLoans;
          
          if (amount > remainingSalary) {
            alert(`Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ (${amount}) ÙŠØªØ¬Ø§ÙˆØ² Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ (${remainingSalary})`);
            return;
          }
        }
      }
      
      const rec = db.loans.find(x=>x.empId===empId && x.date===date);
      if(rec) Object.assign(rec,{amount, status}); 
      else db.loans.push({id:'LN_'+Date.now(), empId, amount, date, status});
      
      logActivity('ØªÙ… Ø­ÙØ¸ Ø³Ù„ÙØ© Ù„Ù…ÙˆØ¸Ù'); 
      saveDB(); 
      document.getElementById('loanModal').style.display='none'; 
      renderAll();
    });
  }

  function renderLoans(){
    const tbody = document.querySelector('#loanTable tbody'); 
    if(!tbody) return;
    
    tbody.innerHTML='';
    db.loans.forEach(l=>{
      const emp = db.employees.find(e=>e.id===l.empId) || {name:'--'};
      const tr = document.createElement('tr'); tr.innerHTML=`<td>${emp.name}</td><td>${l.amount}</td><td>${l.date}</td><td>${l.status}</td><td>
        <button class="btn small" data-id="${l.id}" data-act="editLoan">ØªØ¹Ø¯ÙŠÙ„</button>
        <button class="btn ghost small" data-id="${l.id}" data-act="delLoan">Ø­Ø°Ù</button>
      </td>`;
      tbody.appendChild(tr);
    });
    tbody.querySelectorAll('button').forEach(b=>b.addEventListener('click', e=>{
      const id = e.target.dataset.id; const act = e.target.dataset.act; const rec = db.loans.find(x=>x.id===id);
      if(!rec) return; 
      if(act==='editLoan'){ 
        document.getElementById('loanModal').style.display='flex'; 
        document.getElementById('loanEmp').value=rec.empId; 
        document.getElementById('loanAmount').value=rec.amount; 
        document.getElementById('loanDate').value=rec.date; 
        document.getElementById('loanStatus').value=rec.status; 
        
        // Trigger salary info update
        if(document.getElementById('loanEmp')) {
          document.getElementById('loanEmp').dispatchEvent(new Event('change'));
        }
      }
      if(act==='delLoan'){ db.loans = db.loans.filter(x=>x.id!==id); logActivity('ØªÙ… Ø­Ø°Ù Ø³Ù„ÙØ©'); saveDB(); renderAll(); }
    }));
  }

  // Training
  if(document.getElementById('addTrainingBtn')) {
    document.getElementById('addTrainingBtn').addEventListener('click', ()=>{ 
      document.getElementById('trainingModal').style.display='flex'; 
    });
  }
  
  if(document.getElementById('closeTrainingModal')) {
    document.getElementById('closeTrainingModal').addEventListener('click', ()=>{ document.getElementById('trainingModal').style.display='none'; });
  }
  
  if(document.getElementById('saveTrainingBtn')) {
    document.getElementById('saveTrainingBtn').addEventListener('click', ()=>{
      const name = document.getElementById('trainingName').value;
      const instructor = document.getElementById('trainingInstructor').value;
      const date = document.getElementById('trainingDate').value;
      const description = document.getElementById('trainingDescription').value;
      
      if(!name || !instructor || !date){ alert('Ø§Ù…Ù„Ø£ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©'); return; }
      
      const selectedOptions = document.getElementById('trainingParticipants').selectedOptions;
      const participants = Array.from(selectedOptions).map(option => option.value);
      
      db.trainings.push({
        id: 'T_'+Date.now(), 
        name, 
        instructor, 
        date, 
        description,
        participants,
        evaluation: 0
      });
      
      logActivity('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø¯ÙˆØ±Ø© ØªØ¯Ø±ÙŠØ¨ÙŠØ© Ø¬Ø¯ÙŠØ¯Ø©'); 
      saveDB(); 
      document.getElementById('trainingModal').style.display='none'; 
      renderAll();
    });
  }

  function renderTraining(){
    const tbody = document.querySelector('#trainingTable tbody'); 
    if(!tbody) return;
    
    tbody.innerHTML='';
    db.trainings.forEach(t=>{
      const participantCount = t.participants ? t.participants.length : 0;
      const tr = document.createElement('tr'); 
      tr.innerHTML=`<td>${t.name}</td><td>${t.instructor}</td><td>${t.date}</td><td>${participantCount}</td><td>${t.evaluation || 'Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªÙ‚ÙŠÙŠÙ…'}</td><td>
        <button class="btn small" data-id="${t.id}" data-act="evaluate">ØªÙ‚ÙŠÙŠÙ…</button>
        <button class="btn ghost small" data-id="${t.id}" data-act="delTraining">Ø­Ø°Ù</button>
      </td>`;
      tbody.appendChild(tr);
    });
    
    tbody.querySelectorAll('button').forEach(b=>b.addEventListener('click', e=>{
      const id = e.target.dataset.id; const act = e.target.dataset.act; 
      if(act==='evaluate'){
        const rating = prompt('Ø£Ø¯Ø®Ù„ ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø¯ÙˆØ±Ø© Ù…Ù† 1 Ø¥Ù„Ù‰ 5:');
        if(rating && rating >= 1 && rating <= 5) {
          const training = db.trainings.find(t => t.id === id);
          if(training) {
            training.evaluation = rating;
            logActivity('ØªÙ… ØªÙ‚ÙŠÙŠÙ… Ø¯ÙˆØ±Ø© ØªØ¯Ø±ÙŠØ¨ÙŠØ©');
            saveDB();
            renderAll();
          }
        }
      }
      if(act==='delTraining'){ 
        db.trainings = db.trainings.filter(x=>x.id!==id); 
        logActivity('ØªÙ… Ø­Ø°Ù Ø¯ÙˆØ±Ø© ØªØ¯Ø±ÙŠØ¨ÙŠØ©'); 
        saveDB(); 
        renderAll(); 
      }
    }));
  }

  // Schedules
  if(document.getElementById('addScheduleBtn')) {
    document.getElementById('addScheduleBtn').addEventListener('click', ()=>{ 
      const empId = document.getElementById('scheduleEmpSelect').value;
      if(!empId) { alert('Ø§Ø®ØªØ± Ù…ÙˆØ¸Ù Ø£ÙˆÙ„Ø§Ù‹'); return; }
      
      const schedule = prompt('Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ (ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø³ØªØ®Ø¯Ø§Ù… ØªÙ†Ø³ÙŠÙ‚ Excel):');
      if(schedule) {
        db.schedules.push({
          id: 'S_'+Date.now(),
          empId,
          schedule,
          createdAt: new Date().toISOString()
        });
        logActivity('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø¬Ø¯ÙˆÙ„ Ø¯Ø±Ø§Ø³ÙŠ');
        saveDB();
        renderAll();
      }
    });
  }
  
  if(document.getElementById('exportScheduleBtn')) {
    document.getElementById('exportScheduleBtn').addEventListener('click', ()=>{ 
      const empId = document.getElementById('scheduleEmpSelect').value;
      if(!empId) { alert('Ø§Ø®ØªØ± Ù…ÙˆØ¸Ù Ø£ÙˆÙ„Ø§Ù‹'); return; }
      
      const schedule = db.schedules.find(s => s.empId === empId);
      if(schedule) {
        // Simulate Excel export
        const dataStr = schedule.schedule;
        const blob = new Blob([dataStr], {type:'text/plain'}); 
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a'); 
        a.href = url; 
        a.download = 'Ø¬Ø¯ÙˆÙ„_Ø¯Ø±Ø§Ø³ÙŠ_' + Date.now() + '.txt'; 
        a.click(); 
        URL.revokeObjectURL(url);
        logActivity('ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ');
      } else {
        alert('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¬Ø¯ÙˆÙ„ Ø¯Ø±Ø§Ø³ÙŠ Ù„Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆØ¸Ù');
      }
    });
  }

  function renderSchedules(){
    const scheduleBody = document.getElementById('scheduleBody');
    if(!scheduleBody) return;
    
    const empId = document.getElementById('scheduleEmpSelect').value;
    if(!empId) {
      scheduleBody.innerHTML = '<p class="muted">Ø§Ø®ØªØ± Ù…ÙˆØ¸ÙÙ‹Ø§ Ù„Ø¹Ø±Ø¶ Ø¬Ø¯ÙˆÙ„Ù‡ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ.</p>';
      return;
    }
    
    const schedule = db.schedules.find(s => s.empId === empId);
    const emp = db.employees.find(e => e.id === empId);
    
    if(schedule) {
      scheduleBody.innerHTML = `
        <h3>Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ Ù„Ù€ ${emp ? emp.name : ''}</h3>
        <div class="table-wrap">
          <table class="schedule-table">
            <thead>
              <tr>
                <th>Ø§Ù„ÙŠÙˆÙ…</th><th>Ø§Ù„Ø­ØµØ© Ø§Ù„Ø£ÙˆÙ„Ù‰</th><th>Ø§Ù„Ø­ØµØ© Ø§Ù„Ø«Ø§Ù†ÙŠØ©</th><th>Ø§Ù„Ø­ØµØ© Ø§Ù„Ø«Ø§Ù„Ø«Ø©</th><th>Ø§Ù„Ø­ØµØ© Ø§Ù„Ø±Ø§Ø¨Ø¹Ø©</th><th>Ø§Ù„Ø­ØµØ© Ø§Ù„Ø®Ø§Ù…Ø³Ø©</th>
              </tr>
            </thead>
            <tbody>
              <tr><td>Ø§Ù„Ø£Ø­Ø¯</td><td>Ø±ÙŠØ§Ø¶ÙŠØ§Øª</td><td>Ø¹Ù„ÙˆÙ…</td><td>Ù„ØºØ© Ø¹Ø±Ø¨ÙŠØ©</td><td>ØªØ±Ø¨ÙŠØ© Ø±ÙŠØ§Ø¶ÙŠØ©</td><td>ÙÙ†ÙˆÙ†</td></tr>
              <tr><td>Ø§Ù„Ø§Ø«Ù†ÙŠÙ†</td><td>Ù„ØºØ© Ø¹Ø±Ø¨ÙŠØ©</td><td>Ø±ÙŠØ§Ø¶ÙŠØ§Øª</td><td>Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ§Øª</td><td>Ø¹Ù„ÙˆÙ…</td><td>Ø¯ÙŠÙ†</td></tr>
              <tr><td>Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡</td><td>Ø¹Ù„ÙˆÙ…</td><td>Ù„ØºØ© Ø¹Ø±Ø¨ÙŠØ©</td><td>Ø±ÙŠØ§Ø¶ÙŠØ§Øª</td><td>ØªØ±Ø¨ÙŠØ© Ø±ÙŠØ§Ø¶ÙŠØ©</td><td>ÙÙ†ÙˆÙ†</td></tr>
              <tr><td>Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡</td><td>Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ§Øª</td><td>Ø¹Ù„ÙˆÙ…</td><td>Ù„ØºØ© Ø¹Ø±Ø¨ÙŠØ©</td><td>Ø±ÙŠØ§Ø¶ÙŠØ§Øª</td><td>Ø¯ÙŠÙ†</td></tr>
              <tr><td>Ø§Ù„Ø®Ù…ÙŠØ³</td><td>Ø±ÙŠØ§Ø¶ÙŠØ§Øª</td><td>Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ§Øª</td><td>Ø¹Ù„ÙˆÙ…</td><td>Ù„ØºØ© Ø¹Ø±Ø¨ÙŠØ©</td><td>Ù†Ø´Ø§Ø·</td></tr>
            </tbody>
          </table>
        </div>
        <div class="toolbar" style="margin-top: 16px;">
          <button class="btn small" id="printScheduleBtn">Ø·Ø¨Ø§Ø¹Ø©</button>
          <button class="btn ghost small" id="editScheduleBtn">ØªØ¹Ø¯ÙŠÙ„</button>
        </div>
      `;
    } else {
      scheduleBody.innerHTML = '<p class="muted">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¬Ø¯ÙˆÙ„ Ø¯Ø±Ø§Ø³ÙŠ Ù„Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆØ¸Ù.</p>';
    }
  }

  // Calendar
  function renderCalendar(){
    const calendarGrid = document.getElementById('calendarGrid');
    if(!calendarGrid) return;
    
    // Simple calendar implementation
    const today = new Date();
    const year = today.getFullYear();
    const month = today.getMonth();
    
    const firstDay = new Date(year, month, 1);
    const lastDay = new Date(year, month + 1, 0);
    
    calendarGrid.innerHTML = '';
    
    // Add empty cells for days before the first day of the month
    for(let i = 0; i < firstDay.getDay(); i++) {
      const emptyCell = document.createElement('div');
      emptyCell.className = 'calendar-day';
      calendarGrid.appendChild(emptyCell);
    }
    
    // Add days of the month
    for(let day = 1; day <= lastDay.getDate(); day++) {
      const dayCell = document.createElement('div');
      dayCell.className = 'calendar-day';
      dayCell.textContent = day;
      
      const dateStr = `${year}-${(month+1).toString().padStart(2, '0')}-${day.toString().padStart(2, '0')}`;
      const hasEvent = db.events.some(event => event.date === dateStr);
      
      if(hasEvent) {
        dayCell.classList.add('event');
      }
      
      calendarGrid.appendChild(dayCell);
    }
  }
  
  if(document.getElementById('addEventBtn')) {
    document.getElementById('addEventBtn').addEventListener('click', ()=>{ 
      document.getElementById('eventModal').style.display='flex'; 
    });
  }
  
  if(document.getElementById('closeEventModal')) {
    document.getElementById('closeEventModal').addEventListener('click', ()=>{ document.getElementById('eventModal').style.display='none'; });
  }
  
  if(document.getElementById('saveEventBtn')) {
    document.getElementById('saveEventBtn').addEventListener('click', ()=>{
      const title = document.getElementById('eventTitle').value;
      const date = document.getElementById('eventDate').value;
      const time = document.getElementById('eventTime').value;
      const type = document.getElementById('eventType').value;
      const description = document.getElementById('eventDescription').value;
      
      if(!title || !date){ alert('Ø§Ù…Ù„Ø£ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©'); return; }
      
      db.events.push({
        id: 'EV_'+Date.now(), 
        title, 
        date, 
        time, 
        type,
        description
      });
      
      logActivity('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¹Ø¯ Ø¬Ø¯ÙŠØ¯'); 
      saveDB(); 
      document.getElementById('eventModal').style.display='none'; 
      renderAll();
    });
  }

  // Notifications
  function renderNotifications(){
    const notificationsList = document.getElementById('notificationsList');
    if(!notificationsList) return;
    
    notificationsList.innerHTML = '';
    
    if(db.notifications.length === 0) {
      notificationsList.innerHTML = '<p class="muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª.</p>';
      return;
    }
    
    db.notifications.forEach(notification => {
      const notificationItem = document.createElement('div');
      notificationItem.className = 'notification-item';
      if(!notification.read) {
        notificationItem.style.background = 'var(--primary-ultralight)';
      }
      
      notificationItem.innerHTML = `
        <div class="notification-icon">
          <i>!</i>
        </div>
        <div class="notification-content">
          <strong>${notification.title}</strong>
          <p>${notification.message}</p>
          <div class="notification-time">${new Date(notification.time).toLocaleString()}</div>
        </div>
        ${!notification.read ? '<span class="badge">Ø¬Ø¯ÙŠØ¯</span>' : ''}
      `;
      
      notificationItem.addEventListener('click', () => {
        notification.read = true;
        saveDB();
        renderAll();
      });
      
      notificationsList.appendChild(notificationItem);
    });
    
    // Update notification count
    const unreadCount = db.notifications.filter(n => !n.read).length;
    const notificationCount = document.getElementById('notificationCount');
    if(notificationCount) {
      notificationCount.textContent = unreadCount;
      notificationCount.style.display = unreadCount > 0 ? 'flex' : 'none';
    }
  }
  
  if(document.getElementById('markAllReadBtn')) {
    document.getElementById('markAllReadBtn').addEventListener('click', () => {
      db.notifications.forEach(notification => {
        notification.read = true;
      });
      saveDB();
      renderAll();
    });
  }

  // Employee Profiles
  if(document.getElementById('viewProfileBtn')) {
    document.getElementById('viewProfileBtn').addEventListener('click', ()=>{
      const empId = document.getElementById('profileEmpSelect').value; 
      if(!empId){ alert('Ø§Ø®ØªØ± Ù…ÙˆØ¸Ù'); return; }
      renderEmployeeProfile(empId);
    });
  }

  function renderEmployeeProfile(empId){
    const profileBody = document.getElementById('profileBody');
    if(!profileBody) return;
    
    const emp = db.employees.find(e=>e.id===empId); 
    const att = db.attendance.filter(a=>a.empId===empId); 
    const leaves = db.leaves.filter(l=>l.empId===empId); 
    const loans = db.loans.filter(s=>s.empId===empId);
    const trainings = db.trainings.filter(t => t.participants && t.participants.includes(empId));
    const salaries = db.salaries.filter(s => s.empId === empId);
    
    const totalLoans = loans
      .filter(l => l.status === 'Ù…ÙˆØ§ÙÙ‚')
      .reduce((sum, loan) => sum + (loan.amount || 0), 0);
    
    const remainingSalary = (emp.salary || 0) - totalLoans;
    
    const photoSrc = emp.photo || "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' fill='%237e57c2'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' font-family='Arial' font-size='36' fill='white'%3E%3Ctspan x='50%25' dy='0'%3E${emp.name ? emp.name.charAt(0) : '?'}%3C/tspan%3E%3C/text%3E%3C/svg%3E";
    
    profileBody.innerHTML = `
      <div class="profile-header">
        <div class="profile-image-container">
          <img src="${photoSrc}" class="profile-image" alt="${emp.name}" />
        </div>
        <div>
          <h2>${emp.name}</h2>
          <p>${emp.job||'-'} â€” ${emp.dept||'-'}</p>
          <p>${emp.phone||''} | ${emp.email||''}</p>
        </div>
      </div>
      
      <div class="profile-stats">
        <div class="profile-stat">
          <strong>${att.length}</strong>
          <span>ÙŠÙˆÙ… Ø­Ø¶ÙˆØ±</span>
        </div>
        <div class="profile-stat">
          <strong>${leaves.length}</strong>
          <span>Ø·Ù„Ø¨ Ø¥Ø¬Ø§Ø²Ø©</span>
        </div>
        <div class="profile-stat">
          <strong>${trainings.length}</strong>
          <span>Ø¯ÙˆØ±Ø© ØªØ¯Ø±ÙŠØ¨ÙŠØ©</span>
        </div>
      </div>
      
      <div class="grid">
        <div class="card">
          <h3>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø±Ø§ØªØ¨</h3>
          <p>Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ: <strong>${emp.salary||0}</strong></p>
          <p>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ù„Ù: <strong>${totalLoans}</strong></p>
          <p>Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: <strong>${remainingSalary}</strong></p>
        </div>
        
        <div class="card">
          <h3>Ø¢Ø®Ø± Ø§Ù„Ø¥Ø¬Ø§Ø²Ø§Øª</h3>
          ${leaves.length > 0 ? 
            leaves.slice(0, 3).map(l => `
              <div class="log-item">
                <div>${l.from} Ø¥Ù„Ù‰ ${l.to}</div>
                <div><span class="badge ${l.status === 'Ù…ÙˆØ§ÙÙ‚' ? 'success' : l.status === 'Ù…Ø±ÙÙˆØ¶' ? 'danger' : 'warning'}">${l.status}</span></div>
              </div>
            `).join('') : 
            '<p class="muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø¬Ø§Ø²Ø§Øª</p>'
          }
        </div>
      </div>
      
      <div class="card wide">
        <h3>Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ø§Ù„ØªØ¯Ø±ÙŠØ¨ÙŠØ©</h3>
        ${trainings.length > 0 ? 
          trainings.map(t => `
            <div class="training-card">
              <h4>${t.name}</h4>
              <p>Ø§Ù„Ù…Ø¯Ø±Ø¨: ${t.instructor} | Ø§Ù„ØªØ§Ø±ÙŠØ®: ${t.date}</p>
              <p>${t.description}</p>
            </div>
          `).join('') : 
          '<p class="muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¯ÙˆØ±Ø§Øª ØªØ¯Ø±ÙŠØ¨ÙŠØ©</p>'
        }
      </div>
      
      <div class="card wide">
        <h3>Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©</h3>
        <div class="upload-area" id="uploadArea">
          <p>Ø§Ø³Ø­Ø¨ ÙˆØ£ÙÙ„Øª Ø§Ù„Ù…Ù„ÙØ§Øª Ù‡Ù†Ø§ Ø£Ùˆ Ø§Ù†Ù‚Ø± Ù„Ù„ØªØ­Ù…ÙŠÙ„</p>
          <input type="file" id="fileUpload" style="display:none" />
        </div>
        <div id="documentsList"></div>
      </div>
    `;
    
    // Add file upload functionality
    const uploadArea = document.getElementById('uploadArea');
    const fileUpload = document.getElementById('fileUpload');
    
    if(uploadArea && fileUpload) {
      uploadArea.addEventListener('click', () => {
        fileUpload.click();
      });
      
      fileUpload.addEventListener('change', (e) => {
        const file = e.target.files[0];
        if(file) {
          db.documents.push({
            id: 'D_'+Date.now(),
            empId,
            name: file.name,
            type: file.type,
            size: file.size,
            uploadedAt: new Date().toISOString()
          });
          saveDB();
          renderEmployeeProfile(empId);
          logActivity('ØªÙ… Ø±ÙØ¹ Ù…Ø³ØªÙ†Ø¯ Ù„Ù…ÙˆØ¸Ù');
        }
      });
    }
    
    // Render documents
    const documentsList = document.getElementById('documentsList');
    if(documentsList) {
      const empDocuments = db.documents.filter(d => d.empId === empId);
      if(empDocuments.length > 0) {
        documentsList.innerHTML = `
          <h4>Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª Ø§Ù„Ù…Ø±ÙÙˆØ¹Ø©:</h4>
          <ul>
            ${empDocuments.map(doc => `
              <li>${doc.name} (${new Date(doc.uploadedAt).toLocaleDateString()})</li>
            `).join('')}
          </ul>
        `;
      }
    }
  }

  // Reports
  if(document.getElementById('viewReportBtn')) {
    document.getElementById('viewReportBtn').addEventListener('click', ()=>{
      const empId = document.getElementById('reportEmpSelect').value; if(!empId){ alert('Ø§Ø®ØªØ± Ù…ÙˆØ¸Ù'); return; }
      const emp = db.employees.find(e=>e.id===empId); 
      const att = db.attendance.filter(a=>a.empId===empId); 
      const leaves = db.leaves.filter(l=>l.empId===empId); 
      const loans = db.loans.filter(s=>s.empId===empId);
      const trainings = db.trainings.filter(t => t.participants && t.participants.includes(empId));
      const salaries = db.salaries.filter(s => s.empId === empId);
      
      const totalLoans = loans
        .filter(l => l.status === 'Ù…ÙˆØ§ÙÙ‚')
        .reduce((sum, loan) => sum + (loan.amount || 0), 0);
      
      const remainingSalary = (emp.salary || 0) - totalLoans;
      
      const body = document.getElementById('reportBody'); body.innerHTML = '';
      const div = document.createElement('div'); div.innerHTML = `
        <h3>ØªÙ‚Ø±ÙŠØ±: ${emp.name}</h3>
        <p>Ø§Ù„ÙˆØ¸ÙŠÙØ©: ${emp.job||'-'} â€” Ø§Ù„Ù‚Ø³Ù…: ${emp.dept||'-'}</p>
        <h4>Ø§Ù„Ø±Ø§ØªØ¨</h4>
        <p>Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ: ${emp.salary||0} â€” Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ù„Ù: ${totalLoans} â€” Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${remainingSalary}</p>
        <h4>Ø§Ù„Ø­Ø¶ÙˆØ± (${att.length})</h4>
        <div class="table-wrap"><table class="table"><thead><tr><th>ØªØ§Ø±ÙŠØ®</th><th>Ø¯Ø®ÙˆÙ„</th><th>Ø®Ø±ÙˆØ¬</th></tr></thead><tbody>${att.map(a=>`<tr><td>${a.date}</td><td>${a.in||''}</td><td>${a.out||''}</td></tr>`).join('')}</tbody></table></div>
        <h4>Ø§Ù„Ø¥Ø¬Ø§Ø²Ø§Øª (${leaves.length})</h4>
        <div class="table-wrap"><table class="table"><thead><tr><th>Ù…Ù†</th><th>Ø¥Ù„Ù‰</th><th>Ù†ÙˆØ¹</th><th>Ø­Ø§Ù„Ø©</th></tr></thead><tbody>${leaves.map(l=>`<tr><td>${l.from}</td><td>${l.to}</td><td>${l.type}</td><td>${l.status}</td></tr>`).join('')}</tbody></table></div>
        <h4>Ø§Ù„Ø³Ù„Ù (${loans.length})</h4>
        <div class="table-wrap"><table class="table"><thead><tr><th>Ø§Ù„Ù…Ø¨Ù„Øº</th><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th></tr></thead><tbody>${loans.map(l=>`<tr><td>${l.amount}</td><td>${l.date}</td><td>${l.status}</td></tr>`).join('')}</tbody></table></div>
        <h4>Ø§Ù„ØªØ¯Ø±ÙŠØ¨ (${trainings.length})</h4>
        <div class="table-wrap"><table class="table"><thead><tr><th>Ø§Ø³Ù… Ø§Ù„Ø¯ÙˆØ±Ø©</th><th>Ø§Ù„Ù…Ø¯Ø±Ø¨</th><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</th></tr></thead><tbody>${trainings.map(t=>`<tr><td>${t.name}</td><td>${t.instructor}</td><td>${t.date}</td><td>${t.evaluation || 'Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªÙ‚ÙŠÙŠÙ…'}</td></tr>`).join('')}</tbody></table></div>
      `;
      body.appendChild(div);
    });
  }
  
  if(document.getElementById('trainingReportBtn')) {
    document.getElementById('trainingReportBtn').addEventListener('click', ()=>{
      const body = document.getElementById('reportBody'); body.innerHTML = '';
      const div = document.createElement('div'); div.innerHTML = `
        <h3>ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØªØ¯Ø±ÙŠØ¨ ÙˆØ§Ù„ØªØ·ÙˆÙŠØ±</h3>
        <h4>Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø¹Ø§Ù…Ø©</h4>
        <p>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¯ÙˆØ±Ø§Øª: ${db.trainings.length}</p>
        <p>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ†: ${db.trainings.reduce((sum, t) => sum + (t.participants ? t.participants.length : 0), 0)}</p>
        <p>Ù…ØªÙˆØ³Ø· Ø§Ù„ØªÙ‚ÙŠÙŠÙ…: ${db.trainings.filter(t => t.evaluation).length > 0 ? 
          (db.trainings.reduce((sum, t) => sum + (t.evaluation || 0), 0) / db.trainings.filter(t => t.evaluation).length).toFixed(1) : 
          'Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ‚ÙŠÙŠÙ…Ø§Øª'}</p>
        
        <h4>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¯ÙˆØ±Ø§Øª</h4>
        <div class="table-wrap">
          <table class="table">
            <thead>
              <tr><th>Ø§Ø³Ù… Ø§Ù„Ø¯ÙˆØ±Ø©</th><th>Ø§Ù„Ù…Ø¯Ø±Ø¨</th><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ†</th><th>Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</th></tr>
            </thead>
            <tbody>
              ${db.trainings.map(t => `
                <tr>
                  <td>${t.name}</td>
                  <td>${t.instructor}</td>
                  <td>${t.date}</td>
                  <td>${t.participants ? t.participants.length : 0}</td>
                  <td>${t.evaluation || 'Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªÙ‚ÙŠÙŠÙ…'}</td>
                </tr>
              `).join('')}
            </tbody>
          </table>
        </div>
      `;
      body.appendChild(div);
    });
  }

  // Render dashboard overview
  function renderOverview(){
    const el = document.getElementById('overviewBody');
    if(!el) return;
    
    const employeesCount = db.employees.filter(e=>!e.archived).length; 
    const todays = db.attendance.filter(a=>a.date===new Date().toISOString().slice(0,10)).length;
    
    const totalSalaries = db.employees
      .filter(e => !e.archived)
      .reduce((sum, emp) => sum + (emp.salary || 0), 0);
    
    const totalLoans = db.loans
      .filter(l => l.status === 'Ù…ÙˆØ§ÙÙ‚')
      .reduce((sum, loan) => sum + (loan.amount || 0), 0);
    
    const trainingCount = db.trainings.length;
    const eventCount = db.events.filter(e => e.date >= new Date().toISOString().slice(0,10)).length;
    
    el.innerHTML = `
      <div class="grid">
        <div class="card"><h3>Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</h3><p class="muted">${employeesCount} Ù…ÙˆØ¸Ù</p></div>
        <div class="card"><h3>Ø­Ø¶ÙˆØ± Ø§Ù„ÙŠÙˆÙ…</h3><p class="muted">${todays} ØªØ³Ø¬ÙŠÙ„</p></div>
        <div class="card"><h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø±ÙˆØ§ØªØ¨</h3><p class="muted">${totalSalaries}</p></div>
        <div class="card"><h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ù„Ù</h3><p class="muted">${totalLoans}</p></div>
        <div class="card"><h3>Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ø§Ù„ØªØ¯Ø±ÙŠØ¨ÙŠØ©</h3><p class="muted">${trainingCount} Ø¯ÙˆØ±Ø©</p></div>
        <div class="card"><h3>Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©</h3><p class="muted">${eventCount} Ù…ÙˆØ¹Ø¯</p></div>
      </div>
    `;
    
    const ta = document.getElementById('todayAttendance'); 
    if(!ta) return;
    
    ta.innerHTML='';
    const todayList = db.attendance.filter(a=>a.date===new Date().toISOString().slice(0,10));
    if(!todayList.length) ta.innerHTML='<p class="muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¯Ø®Ù„Ø§Øª Ø§Ù„ÙŠÙˆÙ….</p>';
    else { 
      const ul = document.createElement('div'); ul.className='log'; 
      todayList.forEach(a=>{ 
        const emp = db.employees.find(e=>e.id===a.empId)||{name:'--'}; 
        const d = document.createElement('div'); d.className='log-item'; 
        d.innerHTML=`<strong>${emp.name}</strong><span>${a.in||''} â€” ${a.out||''}</span>`; 
        ul.appendChild(d); 
      }); 
      ta.appendChild(ul); 
    }
  }

  // Shortcuts
  window.addEventListener('keydown', (e) => {
    try {
      const tag = (e.target && e.target.tagName) || '';
      if (['INPUT', 'TEXTAREA', 'SELECT'].includes(tag) || (e.target && e.target.isContentEditable)) return;
      if (!e.shiftKey) return;

      switch (e.code) {
        case 'Digit1': case 'Numpad1': openPage('dashboard'); break;
        case 'Digit2': case 'Numpad2': openPage('employees'); break;
        case 'Digit3': case 'Numpad3': openPage('profiles'); break;
        case 'Digit4': case 'Numpad4': openPage('attendance'); break;
        case 'Digit5': case 'Numpad5': openPage('leaves'); break;
        case 'Digit6': case 'Numpad6': openPage('salaries'); break;
        case 'Digit7': case 'Numpad7': openPage('loans'); break;
        case 'Digit8': case 'Numpad8': openPage('training'); break;
        case 'Digit9': case 'Numpad9': openPage('schedules'); break;
        case 'Digit0': case 'Numpad0': openPage('calendar'); break;
        case 'KeyN': openPage('notifications'); break;
        case 'KeyR': openPage('reports'); break;
        case 'KeyT': openPage('teacherApp'); break;
        case 'KeyS': openPage('settings'); break;
        case 'KeyH': openPage('shortcuts'); break;
        default: break;
      }
    } catch (err) { console.error('shortcut error', err); }
  });

  // Import / Export
  if(document.getElementById('exportBtn')) {
    document.getElementById('exportBtn').addEventListener('click', ()=>{
      const dataStr = JSON.stringify(db, null, 2); const blob = new Blob([dataStr], {type:'application/json'}); const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = 'edara_export_'+Date.now()+'.json'; a.click(); URL.revokeObjectURL(url);
    });
  }
  
  if(document.getElementById('importBtn')) {
    document.getElementById('importBtn').addEventListener('click', ()=>{ document.getElementById('importFile').click(); });
  }
  
  if(document.getElementById('importFile')) {
    document.getElementById('importFile').addEventListener('change', (e)=>{
      const f = e.target.files[0]; if(!f) return; const reader = new FileReader(); reader.onload = ()=>{ try{ const payload = JSON.parse(reader.result); if(confirm('Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ø¨Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…Ø³ØªÙˆØ±Ø¯ØŸ')){ db = payload; forceSave(); renderAll(); logActivity('ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª'); } }catch(err){ alert('Ù…Ù„Ù ØºÙŠØ± ØµØ§Ù„Ø­'); } }; reader.readAsText(f);
    });
  }

  // Settings
  if(document.getElementById('resetBtn')) {
    document.getElementById('resetBtn').addEventListener('click', ()=>{ if(confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡.')){ db = {employees:[], attendance:[], leaves:[], salaries:[], loans:[], activities:[], trainings:[], schedules:[], events:[], notifications:[], documents:[], teacherData: { currentTeacher: null, classSchedules: [], attendance: [], leaveBalance: 21, financialBalance: 5800 }}; forceSave(); renderAll(); logActivity('Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø§Ù„Ù†Ø¸Ø§Ù…'); }});
  }

  // Filters and search
  if(document.getElementById('empSearchInput')) {
    document.getElementById('empSearchInput').addEventListener('input', (e)=>{
      const q = e.target.value.trim().toLowerCase(); const tbody = document.querySelector('#employeesTable tbody'); 
      if(!tbody) return;
      
      tbody.innerHTML='';
      db.employees.filter(emp => emp.name.toLowerCase().includes(q) || (emp.job||'').toLowerCase().includes(q) || (emp.dept||'').toLowerCase().includes(q)).forEach(emp=>{
        const photoSrc = emp.photo || "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='40' height='40' viewBox='0 0 40 40'%3E%3Crect width='40' height='40' fill='%237e57c2'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' font-family='Arial' font-size='16' fill='white'%3E%3Ctspan x='50%25' dy='0'%3E${emp.name ? emp.name.charAt(0) : '?'}%3C/tspan%3E%3C/text%3E%3C/svg%3E";
        
        const tr = document.createElement('tr'); 
        tr.innerHTML = `
          <td><img src="${photoSrc}" class="employee-photo" alt="${emp.name}" /></td>
          <td>${emp.name}</td>
          <td>${emp.job||''}</td>
          <td>${emp.dept||''}</td>
          <td>${emp.salary||0}</td>
          <td>${emp.phone||''}</td>
          <td>
            <button class="btn small" data-id="${emp.id}" data-act="edit">ØªØ¹Ø¯ÙŠÙ„</button>
            <button class="btn ghost small" data-id="${emp.id}" data-act="del">Ø­Ø°Ù</button>
          </td>`; 
        tbody.appendChild(tr);
      });
    });
  }

  // Attendance filter
  if(document.getElementById('filterAtt')) {
    document.getElementById('filterAtt').addEventListener('click', ()=>{
      const d = document.getElementById('attDate').value; if(!d) return alert('Ø§Ø®ØªØ± ØªØ§Ø±ÙŠØ®'); const tbody = document.querySelector('#attendanceTable tbody'); 
      if(!tbody) return;
      
      tbody.innerHTML=''; 
      db.attendance.filter(a=>a.date===d).forEach(a=>{ 
        const emp = db.employees.find(e=>e.id===a.empId)||{name:'--'}; 
        const tr=document.createElement('tr'); 
        tr.innerHTML=`<td>${emp.name}</td><td>${a.date}</td><td>${a.in||''}</td><td>${a.out||''}</td><td>${a.source||''}</td>`; 
        tbody.appendChild(tr); 
      });
    });
  }
  
  if(document.getElementById('clearAttFilter')) {
    document.getElementById('clearAttFilter').addEventListener('click', renderAttendance);
  }

  // Schedule selection
  if(document.getElementById('scheduleEmpSelect')) {
    document.getElementById('scheduleEmpSelect').addEventListener('change', renderSchedules);
  }

  // Utility render all
  function renderAll(){
    renderActivities(); 
    renderEmployees(); 
    renderAttendance(); 
    renderLeaves(); 
    renderSalaries();
    renderLoans(); 
    renderTraining();
    renderSchedules();
    renderCalendar();
    renderNotifications();
    renderOverview(); 
    renderAttendanceSelectors();
  }

  // Initial render
  renderAll();

  // Auto-save toggle
  if(document.getElementById('autoSave')) {
    document.getElementById('autoSave').addEventListener('change', ()=>{ if(document.getElementById('autoSave').checked) forceSave(); });
  }

  // Ensure modals close when clicking outside
  document.querySelectorAll('.modal').forEach(m=>{ m.addEventListener('click', (e)=>{ if(e.target===m) m.style.display='none'; }); });

  // System ready.
  console.log('Edara System Ready - Advanced HR and Educational Management System with Teacher App');
  </script>
</body>
</html>